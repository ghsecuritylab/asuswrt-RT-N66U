var g_support_html5=0,g_reload_page=1,m=new lang,g_storage=new myStorage,g_listview=g_storage.get("listview")==void 0?0:g_storage.get("listview"),g_modal_url,g_modal_window_width=200,g_modal_window_height=80,timer_idle,g_show_modal=0,g_time_out=9E5,g_time_count=0,g_select_mode=0,g_select_array,g_upload_mode=0,g_folder_array,g_file_array,g_opening_uid="",g_on_button_animation=0,g_on_rescan_samba=0,g_rescan_samba_timer=0,g_rescan_samba_count=0,g_aidisk_name="usbdisk",g_enable_aidisk=0,g_support_lan=
["zh-tw","en-us"],g_current_locktoken="",g_mouse_x=0,g_mouse_y=0,g_fileview_only=0,client=new davlib.DavClient;client.initialize();g_support_html5=window.File&&window.FileReader&&window.FileList&&window.Blob?1:0;
function openImageViewer(c){for(var b=[],a=0;a<g_file_array.length;a++){var e=getFileExt(g_file_array[a].href);(e=="jpg"||e=="jpeg"||e=="png"||e=="gif")&&b.push(g_file_array[a])}if(b.length==0)alert(m.getString("msg_no_image_list"));else{for(a=e=0;a<b.length;a++)c==b[a].href&&(e=a);c="";a=getPageSize();c+='<div id="image_slide_show" class="barousel unselectable" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: '+a[0]/2+"px; top: "+a[1]/2+'px; z-index: 2999;">';c+=
'<div class="barousel_image">';for(a=0;a<b.length;a++){var d=window.location.protocol+"//"+window.location.host+b[a].href;c+=a==e?'<img src="" path="'+d+'" alt="" class="default"/>':'<img src="" path="'+d+'" alt="" class=""/>'}c+="</div>";c+='<div class="barousel_nav">';c+='<div class="barousel_content transparent" style="display: block; ">';for(a=0;a<b.length;a++)c+='<div class="',a==e&&(c+="default"),c+='" style="display: none; ">',c+='<p class="header">'+b[a].name+"</p>",c+="</div>";c+="</div>";
c+="</div>";c+="</div>";$(c).animate({width:"100%",height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({navType:2,manualCarousel:1,contentResize:0,startIndex:e})}}
function openAudioPlayer(c){for(var b=[],a=0;a<g_file_array.length;a++)getFileExt(g_file_array[a].href)=="mp3"&&b.push(g_file_array[a]);if(b.length==0)alert(m.getString("msg_no_image_list"));else{for(var e="",d=0,a=0;a<b.length;a++){var h=b[a].href;c==h&&(d=a);e+=h;a!=b.length-1&&(e+=",")}b=$("div#modalWindow");g_modal_url="/smb/css/audio.html?a="+c+"&alist="+e+"&index="+d+"&s=1";g_modal_window_width=450;g_modal_window_height=152;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_audioplayer"));
b&&b.jqmShow()}}
function openLoginWindow(c){var b=$("div#modalWindow"),a=b.css("display"),e=function(){var a=$("#table_login input#username").val(),b=$("#table_login input#password").val(),a="Basic "+Base64.encode(a+":"+b);closeJqmWindow(0);doLOGIN(c,a)};g_modal_url="";g_modal_window_width=380;g_modal_window_height=120;if(c=="/")$("#jqmTitleText").text(m.getString("title_login")+" - AiCloud");else{var d=mydecodeURI(c);$("#jqmTitleText").text(m.getString("title_login")+" - "+d.substring(0,35))}a=="block"&&$("#jqmMsgText").text(m.getString("msg_passerror"));
$("#jqmMsg").css("display",a);a="";a+='<table id="table_login" width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="overflow:hidden;">';a+="<tr>";a+="<td>";a+='<form name="form_login">';a+='<fieldset width="120px">';a+="<table>";a+="<tr>";a+='<td><label id="username">'+m.getString("title_username")+'</label></td><td><input name="username" type="text" id="username" autocapitalize="off" style="width:250px"></td>';a+="</tr>";a+="<tr>";a+='<td><label id="password">'+
m.getString("title_password")+'</label></td><td><input name="password" type="password" id="password" style="width:250px"></td>';a+="</tr>";a+="</table>";a+="</fieldset>";a+="</form>";a+="</td>";a+="</tr>";a+='<tr style="height:10px"></tr>';a+="<tr>";a+="<td>";a+='<div class="table_block_footer" style="text-align:right">';a+='<button id="ok" class="btnStyle">'+m.getString("btn_ok")+"</button>";a+='<button id="cancel" class="btnStyle">'+m.getString("btn_cancel")+"</button>";a+="</div>";a+="</td>";a+=
"</tr>";a+="</table>";$("#jqmContent").empty();$(a).appendTo($("#jqmContent"));$("#table_login input#password").keydown(function(a){a.keyCode==13&&e()});$("#table_login #ok").click(function(){e()});$("#table_login #cancel").click(function(){closeJqmWindow(0)});b&&b.jqmShow()}
function doRescanSamba(){var c=addPathSlash(g_storage.get("openurl"));closeJqmWindow(0);showHideLoadStatus(!0);client.RESCANSMBPC(c,function(b){b[0]==2&&(g_storage.setl("onRescanSamba",1),g_storage.setl("onRescanSambaCount",0),g_storage.set("HostList",""),doPROPFIND("/"))})}
function doMKDIR(c){var b=addPathSlash(g_storage.get("openurl")),a=b+myencodeURI(c),e=0;$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&c==$(this).attr("title")&&(e=1,alert(m.getString("folder_already_exist_msg")))});e!=1&&client.MKCOL(a,function(a){a[0]==2?(doPROPFIND(b),closeJqmWindow(0)):alert(m.getString(a))})}
function doRENAME(c,b){var a=0,e=addPathSlash(g_storage.get("openurl")),d=e+b;$("a#list_item").each(function(){b==myencodeURI($(this).attr("title"))&&(a=1,$(this).attr("isdir")=="1"?alert(m.getString("folder_already_exist_msg")):alert(m.getString("file_already_exist_msg")))});a!=1&&client.LOCK(c,"",function(a,b,g){if(a!="201")alert(m.getString("msg_already_lock"));else{var i=getLockToken(g);client.MOVE(c,d,function(a){a[0]==2?(doPROPFIND(e),closeJqmWindow(0)):alert(m.getString(a));client.UNLOCK(c,
i,function(a){a!=204&&alert("Unlock error: "+a)})},null,"F",i)}},null)}function getFileViewHeight(){return $("#fileview").height()}function closePopupmenu(){$(".popupmenu").remove()}function confirmCancelUploadFile(){if(g_storage.get("isOnUploadFile")==1){if(confirm(m.getString("msg_confirm_cancel_upload"))!=!0)return 0;$("#upload_panel iframe")[0].contentWindow.stop_upload()}return 1}
function closeUploadPanel(c){g_upload_mode=0;g_reload_page=c;g_storage.set("stopLogoutTimer","0");$("div#btnNewDir").css("display","block");$("div#btnUpload").css("display","block");$("div#btnSelect").css("display","block");$("#btnPlayImage").css("display","block");$("div#btnCancelUpload").css("display","none");$("#function_help").text("");$("#upload_panel").animate({left:"1999px"},"slow",null,function(){$("#upload_panel").css("display","none");adjustLayout()});c==1&&(c=addPathSlash(g_storage.get("openurl")),
doPROPFIND(c))}
function cancelSelectMode(){g_select_mode!=0&&(g_select_mode=0,g_select_array=null,$("#btnDownload").addClass("disable"),$("#btnShareLink").addClass("disable"),$("#btnDeleteSel").addClass("disable"),$("#btnRename").addClass("disable"),$("div#btnNewDir").css("display","block"),$("div#btnUpload").css("display","block"),$("div#btnSelect").css("display","block"),$("#btnPlayImage").css("display","block"),$("div#btnCancelSelect").css("display","none"),$(".selectDiv").css("display","none"),$(".selectHintDiv").css("display",
"none"),$("#fileview #fileviewicon").each(function(){$(this).removeClass("select")}),$("#function_help").text(""),adjustLayout(),$("#button_panel").animate({left:"1999px"},"slow",null,function(){}))}
function adjustLayout(){var c=getPageSize(),b=c[0],a=c[1]-$("#header_region").height()-$("#bottom_region").height();$("#main_region").css("height",a);c=c[0];$("#main_region #main_right_region").css("width",c-$("#main_region #main_left_region").width());c=$("#main_left_region").height()-$("#infobar").height()-$("#settingbar").height();a=Math.max(Math.floor(c/40),1)*40;$("#hostview").css("height",a);$("#settingbar").css("padding-top",c-a);var e=0;$("#toolbar .albutton").each(function(){$(this).css("display")==
"block"&&(e+=$(this).width())});$("#urlregion-url").css("width",$("#toolbar").width()-e-20);createOpenUrlUI(g_storage.get("openurl"));c=g_select_mode==1?$("#main_right_container").height()-$("#infobar").height()-$("#button_panel").height():$("#main_right_container").height()-$("#infobar").height();$("#fileview").css("height",c);$("#function_help").css("left",$("#main_left_region").width());(c=$("div#modalWindow"))&&c.css("left",(b-g_modal_window_width)/2)}
function closeJqmWindow(c){g_reload_page=c;c=$("div#modalWindow");$("iframe",c).attr("src","");c&&c.jqmHide();showHideLoadStatus(!1)}function resizeJqmWindow(c,b){var a=$(".jqmWindow");a&&(a.css("width",c+"px"),a.css("height",b+"px"))}function fullscreenJqmWindow(){var c=$("div#modalWindow");c&&(c.css("left","0px"),c.css("top","0px"),c.css("width",window.width+"px"),c.css("height",window.height+"px"))}
function doLOGOUT(){doPROPFIND("/",function(){addPathSlash(g_storage.get("openurl"));client.LOGOUT("/",function(c){c[0]==2&&(g_storage.set("openhostuid","0"),window.location.reload())})},0)}function resetTimer(){clearInterval(timer_idle);g_time_count=0;timer_idle=setInterval(function(){g_storage.get("stopLogoutTimer")=="1"||g_show_modal==1?g_time_count=0:(g_time_count++,g_time_count*1E3>g_time_out&&(g_time_count=0,doLOGOUT()))},1E3)}
function createOpenUrlUI(c){c==void 0&&(c="/");var b=mydecodeURI(c),a="",e="",d="",h=$("#urlregion-url").width();if(b!="/")for(var b=b.split("/"),c=c.split("/"),f=0;f<b.length;f++)if(!(b[f]==""||g_enable_aidisk==1&&b[f]==g_aidisk_name)){e+="/"+c[f];d+=" / <a id='url_path' uhref='"+e+"'>"+b[f]+"</a>";if(String(d).width($("p#openurl").css("font"))>h){a+=" / ...";break}a+=b[1]==g_aidisk_name&&g_enable_aidisk==1?" / <a id='url_path' uhref='/"+g_aidisk_name+e+"'>"+b[f]+"</a>":" / <a id='url_path' uhref='"+
e+"'>"+b[f]+"</a>";d=a}$("p#openurl").empty();$("p#openurl").append(a);$("a#url_path").click(function(){confirmCancelUploadFile()!=0&&doPROPFIND($(this).attr("uhref"))})}
function doPROPFIND(c,b,a){if(client!=null){showHideLoadStatus(!0);try{client.PROPFIND(c,a,function(a,e,f){if(a){if(a==207){cancelSelectMode();closeUploadPanel();g_folder_array=[];g_file_array=[];if(window.DOMParser)a=new DOMParser,e=a.parseFromString(f,"text/xml");else if(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(f),!e.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var g,i,k,j,q,u=e.documentElement.childNodes,f=e.documentElement.getAttribute("qtype");
e.documentElement.getAttribute("readonly");a=e.documentElement.getAttribute("ruser");e.documentElement.getAttribute("computername");e=e.documentElement.getAttribute("isusb");for(g=0;g<u.length;g++){var p="",w="",z="",t="",v="",A="",B="",C="",D="",r="",s="",x="",n="",l;q="";var F="0",y=u[g].childNodes;for(i=0;i<y.length;i++)if(y[i].nodeType==1&&y[i].nodeName=="D:propstat"){var G=y[i].childNodes;for(k=0;k<G.length;k++)if(G[k].nodeName=="D:prop"){var o=G[k].childNodes;for(j=0;j<o.length;j++)if(!(o[j].childNodes.length<=
0))if(o[j].nodeName=="D:getcontenttype")w=String(o[j].childNodes[0].nodeValue);else if(o[j].nodeName=="D:getuniqueid")z=String(o[j].childNodes[0].nodeValue);else if(o[j].nodeName=="D:getonline")A=String(o[j].childNodes[0].nodeValue);else if(o[j].nodeName=="D:getlastmodified")B=String(o[j].childNodes[0].nodeValue);else if(o[j].nodeName=="D:getcontentlength")C=String(size_format(parseInt(o[j].childNodes[0].nodeValue)));else if(o[j].nodeName=="D:getmac")r=String(o[j].childNodes[0].nodeValue);else if(o[j].nodeName==
"D:getip")D=String(o[j].childNodes[0].nodeValue);else if(o[j].nodeName=="D:gettype")s=String(o[j].childNodes[0].nodeValue);else if(o[j].nodeName=="D:getattr"){var E=o[j].childNodes;for(q=0;q<E.length;q++)if(E[q].nodeName=="D:readonly")x=E[q].childNodes[0].nodeValue;else if(E[q].nodeName=="D:hidden")n=E[q].childNodes[0].nodeValue}else o[j].nodeName=="D:getuseragent"?(q=String(o[j].childNodes[0].nodeValue),g_storage.set("user_agent",q)):o[j].nodeName=="D:getroutersync"&&(F=String(o[j].childNodes[0].nodeValue))}}else y[i].nodeType==
1&&y[i].nodeName=="D:href"&&(p=String(y[i].childNodes[0].nodeValue),k="",p.match(/^http/)&&(k=window.location.protocol+"//"+window.location.host),j=k+addPathSlash(c),p!=j?(p=p.replace(k,""),t=p.substring(p.lastIndexOf("/")+1,p.length),t!=""?(l=t,v=t=mydecodeURI(t),k=g_listview==0?12:45,v.length>k&&(v=v.substring(0,k)+"...")):p=""):p="");p!=""&&(w=="httpd/unix-directory"?g_folder_array.push({contenttype:w,href:p,name:t,uname:l,shortname:v,online:A,time:B,size:C,ip:D,mac:r,uid:z,type:s,freadonly:x,
fhidden:n,routersyncfolder:F}):g_file_array.push({contenttype:w,href:p,name:t,uname:l,shortname:v,online:A,time:B,size:C,ip:D,mac:r,uid:z,type:s,freadonly:x,fhidden:n,routersyncfolder:F}))}g_folder_array.sort(sortByName);g_file_array.sort(sortByName);for(l=0;l<g_folder_array.length;l++)g_folder_array[l].type=="usbdisk"&&arraymove(g_folder_array,l,0);l=addPathSlash(c);l!="/"&&(l=l.substring(0,l.length-1),l=l.substring(0,l.lastIndexOf("/")),l==""&&(l="/"));createHostList(f,g_folder_array);createThumbView(f,
l,g_folder_array,g_file_array);f==0&&g_select_mode==0?($("#btnUpload").css("display","block"),$("#btnSelect").css("display","block"),$("#btnNewDir").css("display","block"),$("#btnPlayImage").css("display","block")):($("#btnUpload").css("display","none"),$("#btnSelect").css("display","none"),$("#btnNewDir").css("display","none"),$("#btnPlayImage").css("display","none"));g_select_mode==1&&$("#btnCancelSelect").css("display","block");g_upload_mode==1&&$("#btnCancelUpload").css("display","block");f==
1&&e==0?$("#btnChangeUser").css("display","block"):$("#btnChangeUser").css("display","none");$("span#username").text(a);g_storage.set("openurl",c);$("div#hostview").scrollTop(g_storage.get("hostviewscrollTop"));$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));adjustLayout();closeJqmWindow(0);b!=void 0&&b()}else a==501?doPROPFIND(c):a==401?setTimeout(openLoginWindow(c),2E3):alert(m.getString(a));showHideLoadStatus(!1)}},
null,1),resetTimer()}catch(e){alert("catch error: "+e)}}}function registerPage(c){if(!(c!="/"||isPrivateIP(g_storage.get("wan_ip"))))c=g_storage.get("ddns_host_name"),c==""?alert("start ddns process"):window.location="http://140.130.25.39/aicloud?v=https://"+c}
function doLOGIN(c,b){doPROPFIND(c,function(){g_opening_uid!=""&&(g_storage.set("openhostuid",g_opening_uid),$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).addClass("select"):$(this).removeClass("select")}),g_opening_uid="")},b)}
function refreshHostList(){if(client!=null)try{client.PROPFIND("/",null,function(b,a,c){if(b&&b==207){var d,b=[];if(window.DOMParser)a=new DOMParser,d=a.parseFromString(c,"text/xml");else if(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c),!d.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var h,f,g,i,a=d.documentElement.childNodes,c=d.documentElement.getAttribute("qtype");d.documentElement.getAttribute("readonly");d.documentElement.getAttribute("ruser");
d.documentElement.getAttribute("computername");d.documentElement.getAttribute("isusb");for(d=0;d<a.length;d++){var k="",j="",q="",u="",p="",w="",z="",t="",v="",A="",B="",C="",D="",r,s=a[d].childNodes;for(h=0;h<s.length;h++)if(s[h].nodeType==1&&s[h].nodeName=="D:propstat"){var x=s[h].childNodes;for(f=0;f<x.length;f++)if(x[f].nodeName=="D:prop"){var n=x[f].childNodes;for(g=0;g<n.length;g++)if(!(n[g].childNodes.length<=0))if(n[g].nodeName=="D:getcontenttype")j=String(n[g].childNodes[0].nodeValue);else if(n[g].nodeName==
"D:getuniqueid")q=String(n[g].childNodes[0].nodeValue);else if(n[g].nodeName=="D:getonline")w=String(n[g].childNodes[0].nodeValue);else if(n[g].nodeName=="D:getlastmodified")z=String(n[g].childNodes[0].nodeValue);else if(n[g].nodeName=="D:getcontentlength")t=String(size_format(parseInt(n[g].childNodes[0].nodeValue)));else if(n[g].nodeName=="D:getmac")A=String(n[g].childNodes[0].nodeValue);else if(n[g].nodeName=="D:getip")v=String(n[g].childNodes[0].nodeValue);else if(n[g].nodeName=="D:gettype")B=
String(n[g].childNodes[0].nodeValue);else if(n[g].nodeName=="D:getattr"){var l=n[g].childNodes;for(i=0;i<l.length;i++)if(l[i].nodeName=="D:readonly")C=l[i].childNodes[0].nodeValue;else if(l[i].nodeName=="D:hidden")D=l[i].childNodes[0].nodeValue}}}else s[h].nodeType==1&&s[h].nodeName=="D:href"&&(k=String(s[h].childNodes[0].nodeValue),f="",k.match(/^http/)&&(f=window.location.protocol+"//"+window.location.host),g=f+addPathSlash("/"),k!=g?(k=k.replace(f,""),u=k.substring(k.lastIndexOf("/")+1,k.length),
u!=""?(r=u,p=u=mydecodeURI(u),f=g_listview==0?12:45,p.length>f&&(p=p.substring(0,f)+"...")):k=""):k="");k!=""&&j=="httpd/unix-directory"&&b.push({contenttype:j,href:k,name:u,uname:r,shortname:p,online:w,time:z,size:t,ip:v,mac:A,uid:q,type:B,freadonly:C,fhidden:D})}b.sort(sortByName);for(r=0;r<b.length;r++)b[r].type=="usbdisk"&&arraymove(b,r,0);createHostList(c,b)}},null,1)}catch(c){alert("catch error: "+c)}}
function createHostList(c,b){var a="";$("#hostview").empty();var e=g_storage.get("HostList")?g_storage.get("HostList").split(/,/):[],d=g_storage.getl("onRescanSamba"),h=g_storage.getl("onRescanSambaCount");if(c==2)for(var f=0;f<b.length;f++){var g=b[f].href+"|"+b[f].name+"|"+b[f].online+"|"+b[f].ip+"|"+b[f].mac+"|"+b[f].uid+"|"+b[f].freadonly+"|"+b[f].fhidden+"|"+b[f].type;e.contains(g)||e.push(g);g_storage.set("HostList",e.join(","))}for(f=0;f<e.length;f++)g=e[f].split("|"),a+="<div class='host_item unselectable",
g[2]==0&&(a+=" offline"),a+="' uhref='",a+=g[0],a+="' title='",a+=g[1]+" - "+g[3],a+="' online='",a+=g[2],a+="' isdir='1'",a+=" ip='",a+=g[3],a+="' mac='",a+=g[4],a+="' uid='",a+=g[5],a+="' freadonly='",a+=g[6],a+="' fhidden='",a+=g[7],a+=g[8]=="usbdisk"?"' isusb='1'":"' isusb='0'",a+=">",a+="<div id='hosticon' class='sicon "+g[8],g[2]==0&&(a+="off"),a+="'/>",a+="<div id='hostname' class='unselectable'>",a+="<p>",a+=g[1],g[2]==0&&(a+="("+m.getString("title_offline")+")"),a+="</p>",a+="</div>",a+=
"</div>";d==1&&(a+="<div class='scan_item unselectable rescan'>",a+="<div id='hosticon' class='sicon sambapcrescan'/>",a+="<div id='scanlabel' class='unselectable'>",a+="<p>"+m.getString("title_scan"),a+="</p>",a+="</div>",a+="</div>",g_rescan_samba_timer==0&&(g_rescan_samba_timer=setInterval(function(){h++;h>=10?(clearInterval(g_rescan_samba_timer),g_storage.setl("onRescanSamba",0),g_storage.setl("onRescanSambaCount",0)):g_storage.setl("onRescanSambaCount",h);refreshHostList()},5E3)));$("#hostview").append(a);
var i=g_storage.get("openhostuid");$("#hostview .host_item").each(function(){$(this).attr("uid")==i?$(this).addClass("select"):$(this).removeClass("select")});$("#hostview .host_item").click(function(){if(confirmCancelUploadFile()!=0)if($(this).attr("online")==0)confirm(m.getString("wol_msg"))==!0&&client.WOL("/",$(this).attr("mac"),function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))});else{g_opening_uid=$(this).attr("uid");var a=$(this).attr("uhref");g_storage.set("opentype",
$(this).attr("type")=="usbdisk"?"1":"0");doPROPFIND(a,function(){g_storage.set("openhostuid",g_opening_uid);$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).addClass("select"):$(this).removeClass("select")});g_opening_uid=""},null)}})}
function createThumbView(c,b,a,e){var d="";$("#main_right_container #fileview").empty();if(c!=2){c==0&&(d+='<div class="albumDiv">',d+='<table class="thumb-table-parent">',d+="<tbody>",d+="<tr><td>",d+='<div class="picDiv" isParent="1" popupmenu="0" uhref="',d+=b,d+='">',d+='<div class="parentDiv bicon"></div></div>',d+="</td></tr>",d+="<tr><td>",d+='<div class="albuminfo">',d+='<a id="list_item" qtype="1" isdir="1" uhref="',d+=b,d+='" title="'+m.getString("btn_prevpage")+'" online="0">'+m.getString("btn_prevpage"),
d+="</a>",d+="</div>",d+="</td></tr>",d+="</tbody>",d+="</table>",d+="</div>");for(b=0;b<a.length;b++){var h=m.getString("table_filename")+": "+a[b].name;a[b].time!=""&&(h+="\n"+m.getString("table_time")+": "+a[b].time);d+='<div class="albumDiv" ';d+=' title="';d+=h;d+='">';d+='<table class="thumb-table-parent">';d+="<tbody>";d+="<tr><td>";d+='<div class="picDiv" popupmenu="';d+=c=="0"?"1":"0";d+='" uhref="';d+=a[b].href;d+='">';d+=c=="2"?a[b].type=="usbdisk"?'<div id="fileviewicon" class="usbDiv bicon">':
a[b].online=="1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':'<div id="fileviewicon" class="folderDiv bicon">';a[b].routersyncfolder=="1"&&(d+='<div id="routersyncicon" class="routersyncDiv sicon"></div>');d+='<div class="selectDiv sicon"></div>';d+='<div class="selectHintDiv sicon"></div>';d+="</div></div>";d+="</td></tr>";d+="<tr><td>";d+='<div class="albuminfo">';d+='<a id="list_item" qtype="';d+=c;d+='" isdir="1" uhref="';d+=a[b].href;
d+='" title="';d+=a[b].name;d+='" online="';d+=a[b].online;d+='" ip="" mac="';d+=a[b].mac;d+='" uid="';d+=a[b].uid;d+='" freadonly="';d+=a[b].freadonly;d+='" fhidden="';d+=a[b].fhidden;d+=a[b].type=="usbdisk"?'" isusb="1"':'" isusb="0"';d+='">';d+=a[b].shortname;a[b].online=="0"&&c=="2"&&(d+="("+m.getString("title_offline")+")");d+="</a>";d+="</div>";d+="</td></tr>";d+="</tbody>";d+="</table>";d+="</div>";a[b].type=="usbdisk"&&c==1&&g_fileview_only==0&&client.GETDISKSPACE("/",a[b].name,function(a,
b,c){a==200&&(a=parseXml(c),b=$(a),a=$('a#list_item[title="'+b.find("DiskName").text()+'"]').parents(".albumDiv"),b=a.attr("title")+"\n"+m.getString("table_diskusedpercent")+": "+b.find("DiskUsedPercent").text(),a.attr("title",b))})}for(b=0;b<e.length;b++)h=m.getString("table_filename")+": "+e[b].name+"\n"+m.getString("table_time")+": "+e[b].time+"\n"+m.getString("table_size")+": "+e[b].size,d+='<div class="albumDiv"',d+=' title="',d+=h,d+='">',d+='<table class="thumb-table-parent">',d+="<tbody>",
a=getFileExt(String(e[b].href)),a.length>5&&(a=""),d+="<tr><td>",d+=c=="0"?'<div class="picDiv" popupmenu="1" uhref="':'<div class="picDiv" popupmenu="0" uhref="',d+=e[b].href,d+='">',d+=a=="jpg"||a=="jpeg"||a=="png"||a=="gif"||a=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':a=="mp3"||a=="m4a"||a=="m4r"||a=="wav"?'<div id="fileviewicon" class="audiofileDiv bicon">':a=="mp4"||a=="rmvb"||a=="m4v"||a=="wmv"||a=="avi"||a=="mpg"||a=="mpeg"||a=="mkv"||a=="mov"||a=="flv"||a=="3gp"||a=="m2v"||
a=="rm"?'<div id="fileviewicon" class="videofileDiv bicon">':a=="doc"||a=="docx"?'<div id="fileviewicon" class="docfileDiv bicon">':a=="ppt"||a=="pptx"?'<div id="fileviewicon" class="pptfileDiv bicon">':a=="xls"||a=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv bicon">':a=="pdf"?'<div id="fileviewicon" class="pdffileDiv bicon">':'<div id="fileviewicon" class="fileDiv bicon">',d+='<div class="selectDiv sicon"></div>',d+='<div class="selectHintDiv sicon"></div>',d+="</div></div>",d+="</td></tr>",
d+="<tr><td>",d+='<div class="albuminfo" style="font-size:80%">',d+='<a id="list_item" qtype="1" isdir="0" uhref="',d+=e[b].href,d+='" title="',d+=e[b].name,d+='" uid="',d+=e[b].uid,d+='" ext="',d+=a,d+='" freadonly="',d+=e[b].freadonly,d+='" fhidden="',d+=e[b].fhidden,d+='">',d+=e[b].shortname,d+="</a>",d+="</div>",d+="</td></tr>",d+="</tbody>",d+="</table>",d+="</div>";$("#main_right_container #fileview").append(d);$(".picDiv").mousedown(onMouseDownPicDIVHandler)}}
function sortByName(c,b){var a=c.name.toLowerCase(),e=b.name.toLowerCase();return a<e?-1:a>e?1:0}function arraymove(c,b,a){var e=c[b];c.splice(b,1);c.splice(a,0,e)}function showHideLoadStatus(c){c?$("#loading").css("display","block"):$("#loading").css("display","none")}
function onMouseDownPicDIVHandler(c){if(c.button==2||g_on_button_animation==1)return!1;if(g_select_mode==1)if($(this).attr("isParent")==1)cancelSelectMode(),openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"));else{$(this).find(".selectDiv").css("display")=="none"?($(this).find(".selectDiv").css("display","block"),$(this).find(".selectHintDiv").css("display","none")):($(this).find(".selectDiv").css("display","none"),$(this).find(".selectHintDiv").css("display","block"));g_select_array=
null;g_select_array=[];var b=0,a=0;$("#fileview").find(".albumDiv").each(function(){if($(this).find(".selectDiv").css("display")=="block"){var c=$(this).find("#list_item").attr("uhref"),d=$(this).find("#list_item").attr("isdir"),h=myencodeURI($(this).find("#list_item").attr("title"));d==1?a++:b++;g_select_array.push({isdir:d,uhref:c,title:h})}});$("#btnDownload").removeClass("disable");$("#btnShareLink").removeClass("disable");b>0||a>0?$("#btnDeleteSel").removeClass("disable"):$("#btnDeleteSel").addClass("disable");
b+a==1?$("#btnRename").removeClass("disable"):$("#btnRename").addClass("disable")}else openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}
function openSelItem(c){var b=c.attr("uhref"),a=c.attr("qtype"),e=c.attr("isdir"),d=c.attr("isusb"),h=c.attr("uhref"),f=c.attr("title");g_storage.set("openuid",c.attr("uid"));g_storage.set("opentype",d);if(a==2&&c.attr("online")==0)confirm(m.getString("wol_msg"))==!0&&(b=c.attr("mac"),client.WOL("/",b,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}));else if(e=="1")doPROPFIND(b,null,null);else{c=getFileExt(b);a=g_storage.get("webdav_mode");if(c=="mp4"||c=="m4v"||
c=="wmv"||c=="avi"||c=="rmvb"||c=="rm"||c=="mpg"||c=="mpeg"||c=="mkv"||c=="mov"||c=="flv")if((a==0||a==2)&&isWinOS())if(isBrowser("msie")&&getInternetExplorerVersion()<=7)alert(m.getString("msg_vlcsupport"));else{var g=$("div#modalWindow"),f=myencodeURI(f);this_url=h.substring(0,h.lastIndexOf("/"));var i=window.location.host;i.indexOf(":")!=-1&&(i=i.substring(0,i.indexOf(":")));i="http://"+i+":"+g_storage.get("http_port")+"/";client.GSL(this_url,this_url,f,0,0,function(a,b,c){a==200&&(a=parseXml(c),
a=$(a).find("sharelink").text(),b="",a=i+a,b="/smb/css/vlc_video.html?v="+a,b+="&showbutton=1",g_modal_url=b,g_modal_window_width=655,g_modal_window_height=500,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_videoplayer")),g&&g.jqmShow())});return}if(c=="mp3")openAudioPlayer(b);else{if(c=="doc"||c=="docx"||c=="ppt"||c=="pptx"||c=="xls"||c=="xlsx"||c=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){f=myencodeURI(f);this_url=h.substring(0,h.lastIndexOf("/"));client.GSL(this_url,
this_url,f,0,0,function(a,b,c){a==200&&(a=parseXml(c),a=$(a).find("sharelink").text(),b="",a=window.location.protocol+"//"+window.location.host+"/"+a,window.open("https://docs.google.com/viewer?url="+a))});return}c=="jpg"||c=="jpeg"||c=="png"||c=="gif"?openImageViewer(b):window.open(b)}}}
function createLayout(){var c=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),c=g_storage.get("lan")==void 0?c:g_storage.get("lan"),c=m.setLanguage(c);$("body").attr("openurl")!=void 0&&g_storage.set("openurl",$("body").attr("openurl"));$("body").attr("fileview_only")!=void 0&&(g_fileview_only=$("body").attr("fileview_only"));var b="";b+="<div id='header_region' class='unselectable' width='100%' border='0'>";b+="<div id='logo'></div>";g_fileview_only==0&&(b+="<div id='user'>Welcome home, <span id='username'></span><span id='login_info'></span>",
b+="</div>");b+="<div id='loading'><img src='/smb/css/load.gif'/><div><span>Loading...</span></div></div>";b+="<ul class='navigation' id='lan'>";b+="<li>";b+="<dl>";b+="<dt><a id='"+c+"'>"+m.getString("lan_"+c)+"</a></dt>";for(var a=0;a<g_support_lan.length;a++)g_support_lan[a]!=c&&(b+="<dd><a id='"+g_support_lan[a]+"'>"+m.getString("lan_"+g_support_lan[a])+"</a></dt>");b+="</dl>";b+="</li>";b+="<ul>";b+="</div>";b+="<div id='main_region' class='unselectable'>";g_fileview_only==0?(b+="<div id='main_left_region' class='unselectable'>",
b+="<div id='infobar' class='unselectable'></div>",b+="<div id='hostview' class='unselectable'></div>"):b+="<div id='main_left_region' class='unselectable hidehostview'>";b+="</div>";b+="<div id='main_right_region' class='unselectable'>";b+="<div id='main_right_container' class='unselectable'>";b+="<div id='infobar' class='unselectable'>";b+="<div id='toolbar' class='unselectable'>";b+="<div id='urlregion-url'>";b+="<p id='openurl' align='left' width='150' style='padding-left:10px' ></p>";b+="</div>";
g_fileview_only==0&&(b+="<div class='albutton toolbar-button-right' id='btnUpload' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnPlayImage' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnNewDir' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnSelect' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnCancelSelect' style='display:none'><div class='ticon'></div></div>",
b+="<div class='albutton toolbar-button-right' id='btnCancelUpload' style='display:none'><div class='ticon'></div></div>",b+="<div class='albutton toolbar-button-right' id='btnChangeUser' style='display:none'><div class='ticon'></div></div>");b+="</div>";b+="</div>";b+="<div id='fileview' class='unselectable'></div>";b+="<div id='button_panel' class='unselectable'>";b+="<div class='abbutton toolbar-button-right disable' id='btnShareLink' style='display:block'><div class='ticon'></div></div>";b+="<div class='abbutton toolbar-button-right disable' id='btnDeleteSel' style='display:block'><div class='ticon'></div></div>";
b+="<div class='abbutton toolbar-button-right disable' id='btnDownload' style='display:block'><div class='ticon'></div></div>";b+="<div class='abbutton toolbar-button-right disable' id='btnRename' style='display:block'><div class='ticon'></div></div>";b+="</div>";b+="<div id='upload_panel' class='unselectable'>";b+="<div style='position:absolute;width:98%;height:100%;padding:10px'>";b+="<iframe src='' width='100%' height='100%' frameborder='0'/>";b+="</div>";b+="</div>";b+="</div>";b+="</div>";b+=
"</div>";b+="<div id='bottom_region' class='unselectable'>";g_fileview_only==0&&(b+="<ul class='navigation' id='setting'>",b+="<li>",b+="<dl>",b+="<dd><a id='help'>"+m.getString("title_help")+"</a></dt>",b+="<dd><a id='version'>"+m.getString("title_version")+"</a></dt>",b+="<dd><a id='sharelink'>"+m.getString("title_sharelink")+"</a></dt>",b+="<dd><a id='rescan_samba'>"+m.getString("title_rescan")+"</a></dt>",b+="<dd><a id='config'>"+m.getString("btn_config")+"</a></dt>",b+="<dd><a id='favorite'>"+
m.getString("btn_favorite")+"</a></dt>",b+="<dd><a id='logout'>"+m.getString("title_logout")+"</a></dt>",b+="<dt><a>"+m.getString("title_setting")+"</a></dt>",b+="</dl>",b+="</li>",b+="</ul>",b+="<ul class='navigation' id='refresh'>",b+="<li>",b+="<dl>",b+="<dt><a>"+m.getString("btn_refresh")+"</a></dt>",b+="</dl>",b+="</li>",b+="</ul>",b+="<ul class='themes'>",b+="<span>"+m.getString("title_skin")+"</span>",b+="<span id='skin1' class='themes_ctrl'></span>",b+="<span id='skin2' class='themes_ctrl'></span>",
b+="</ul>");b+="<ul class='func_help'>";b+="<span id='function_help'></span>";b+="</ul>";b+="<span id='right_info'>ASUSTeK Computer Inc. All rights reserved</span>";b+="</div>";b+="<div id='modalWindow' class='jqmWindow'>";b+="<div id='jqmTitle'>";b+="<span id='jqmTitleText'></span>";b+="</div>";b+="<div id='jqmMsg'>";b+="<span id='jqmMsgText'></span>";b+="</div>";b+="<div id='jqmContent' style='padding;0px;margin:0px'>";b+="</div>";b+="</div>";$("body").empty();$("body").append(b);$("body").click(function(){closePopupmenu()});
$("span#username").click(function(){confirm(m.getString("msg_logout_confirm"))==!0&&doLOGOUT()});c=g_storage.getl("skin")==void 0?"skin1":g_storage.getl("skin");c=="skin1"?$("#mainCss").attr("href","/smb/css/style-theme1.css"):c=="skin2"&&$("#mainCss").attr("href","/smb/css/style-theme2.css");$("#btnHelp").attr("title",m.getString("title_help"));$("#btnLogout").attr("title",m.getString("title_logout"));$("#btnConfig").attr("title",m.getString("btn_config"));$("#btnUpload").attr("title",m.getString("btn_upload"));
$("#btnCancelUpload").attr("title",m.getString("btn_cancelupload"));$("#btnSelect").attr("title",m.getString("btn_select"));$("#btnCancelSelect").attr("title",m.getString("btn_cancelselect"));$("#btnNewDir").attr("title",m.getString("btn_newdir"));$("#btnShareLink").attr("title",m.getString("btn_sharelink"));$("#btnDeleteSel").attr("title",m.getString("btn_delselect"));$("#btnDownload").attr("title",m.getString("func_download"));$("#btnRename").attr("title",m.getString("btn_rename"));$("#btnSetting").attr("title",
m.getString("title_setting"));$("#btnRefresh").attr("title",m.getString("btn_refresh"))}
function addtoFavorite(){var c="https://"+g_storage.get("ddns_host_name"),b=isBrowser("msie");if(c==""||c==void 0)c="https://www.asusnetwork.net/";if(typeof window.sidebar=="object"&&typeof window.sidebar.addPanel=="function")return window.sidebar.addPanel("AiCloud",c,""),!1;else if(b&&typeof window.external=="object")return window.external.AddFavorite(c,"AiCloud"),!1;else{window.location=c;var c=navigator.userAgent.toLowerCase(),b="",a=c.indexOf("webkit")!=-1,e=c.indexOf("mac")!=-1;if(c.indexOf("konqueror")!=
-1)b="CTRL + B";else if(window.home||a||e)b=(e?"Command/Cmd":"CTRL")+" + D";b=b?m.getString("msg_add_favorite1")+b+m.getString("msg_add_favorite2"):b;alert(b)}}var IE=document.all?!0:!1;IE||document.captureEvents(Event.MOUSEMOVE);
function getMouseXY(c){IE?(g_mouse_x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g_mouse_y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop):(g_mouse_x=c.pageX,g_mouse_y=c.pageY);g_mouse_x<0&&(g_mouse_x=0);g_mouse_y<0&&(g_mouse_y=0);return!0}
$(document).ready(function(){function c(a){a&&a[0]!=2?alert(m.getString(a)+" : "+decodeURI(g_selected_files[0])):(g_selected_files.splice(0,1),g_selected_files.length<=0?(a=addPathSlash(g_storage.get("openurl")),doPROPFIND(a)):client.DELETE(g_selected_files[0],c))}document.oncontextmenu=function(){return!1};document.onmousedown=function(){resetTimer()};document.onmousemove=function(a){getMouseXY(a);resetTimer()};$(document).keydown(function(a){if(a.keyCode==27){if(g_select_mode==1)cancelSelectMode();
else if(g_upload_mode==1){if(confirmCancelUploadFile()==0)return;closeUploadPanel()}closeJqmWindow()}});g_storage.set("stopLogoutTimer","0");g_storage.set("isOpenModalWindow","0");g_storage.set("isOnUploadFile","0");createLayout();showHideLoadStatus(!1);adjustLayout();(function(){var a=g_storage.get("openurl");client.GETROUTERINFO(a==void 0?"/":a,function(a,b,c){a==200&&(a=parseXml(c),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),
g_storage.set("https_port",a.find("https_port").text()),g_storage.set("http_enable",a.find("http_enable").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",String(a.find("misc_http_port").text()).replace("\n","")),g_storage.set("misc_https_port",String(a.find("misc_https_port").text()).replace("\n","")),g_storage.set("last_login_info",a.find("last_login_info").text()),g_storage.set("ddns_host_name",a.find("ddns_host_name").text()),g_storage.set("router_version",
a.find("version").text()),g_storage.set("wan_ip",a.find("wan_ip").text()),a=g_storage.get("last_login_info"),a!=""&&a!=void 0&&(a=String(a).split(">"),a=m.getString("title_logininfo")+a[1]+", "+m.getString("title_ip")+a[2],$("#login_info").text(a)))})})();if(g_fileview_only==0){var b=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){b!=void 0&&b!="/"&&doPROPFIND(b);if(g_storage.get("openhostuid")==void 0||g_storage.get("openhostuid")==0){var a="<div id='help_1'>";a+=
"<div id='help_content'>";a+=m.getString("msg_help");a+="</div>";a+="<div id='help_image'>";a+="</div>";a+="</div>";$("div#fileview").append(a)}},0)}else b=g_storage.get("openurl"),doPROPFIND(b);$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(a){var b=$(a.w);a.o.remove();b.fadeOut("200",function(){g_show_modal=0;if(g_reload_page==1){var a=addPathSlash(g_storage.get("openurl"));doPROPFIND(a)}})},onShow:function(a){var a=$(a.w),b=$("#jqmContent",a);$("#jqmTitle",a);var c=
(getPageSize()[0]-g_modal_window_width)/2;g_show_modal=1;navigator.userAgent.toLowerCase().indexOf("msie");var h=function(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a};g_modal_url!=""&&(b.empty(),$("<iframe src='' frameborder='0' width='100%' height='100%'>").appendTo(b),$("iframe",a).attr("src",g_modal_url));isBrowser("msie")&&h()<=8&&(g_modal_window_height+=25);a.css({width:g_modal_window_width,
height:g_modal_window_height,left:c,top:-g_modal_window_height,opacity:0,display:"block"}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:c,marginLeft:0,opacity:1},200,function(){adjustLayout();$(this).css("display","block")})}});$("div#btnDeleteSel").click(function(){if(!(g_select_array.length<=0)&&confirm(m.getString("del_files_msg"))==!0){g_selected_files=null;g_selected_files=[];for(var a=0;a<g_select_array.length;a++)g_selected_files.push(g_select_array[a].uhref);
client.DELETE(g_selected_files[0],c)}});$("div#btnNewDir").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/makedir.html";g_modal_window_width=500;g_modal_window_height=80;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_newdir"));a&&a.jqmShow()});$("div#btnShareLink").click(function(){if(!(g_select_array.length<=0)){m.getString("email_subject");for(var a="",b="",c="",h=0;h<g_select_array.length;h++){var f=g_select_array[h].title,b=g_select_array[h].uhref,
g=window.location.href,b=g=b.substring(0,b.lastIndexOf("/"));c+=f;c+=";"}var h=g_storage.get("webdav_mode"),f=g_storage.get("ddns_host_name"),i=f==""?window.location.host:f;i.indexOf(":")!=-1&&(i=i.substring(0,i.indexOf(":")));var k=isPrivateIP(i),i=h==0?"http://"+i+":"+g_storage.get("http_port"):"https://"+i;client.GSL(b,b,c,86400,1,function(b,c,d){if(b==200)if(b=parseXml(d),b=$(b).find("sharelink").text(),b=="")alert("Fail to parse xml!");else{b=b.split(";");c=b.length;for(d=0;d<c;d++)a+=i+"/"+
b[d],d!=c-1&&(a+="<br><br>");b=$("div#modalWindow");g_modal_url="/smb/css/sharelink.html?v="+a+"&b="+k;g_modal_window_width=600;g_modal_window_height=500;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_sharelink"));b&&b.jqmShow()}})}});$("div#btnDownload").click(function(){if(!(g_select_array.length<=0)){for(var a=[],b=0;b<g_select_array.length;b++){var c=g_select_array[b].title,h=g_select_array[b].uhref,f=g_select_array[b].isdir,g=window.location.href,g=h.substring(0,
h.lastIndexOf("/")),c=g+"/"+c;f==1?a.push(c):$.fileDownload(c,{successCallback:function(){},failCallback:function(a,b){window.open(b)}})}c=a.length;if(c>0){f="";for(b=0;b<c;b++)f+=a[b],b!=c-1&&(f+=";");a=$("div#modalWindow");g_modal_url="/smb/css/download_folder.html?v="+f+"&u="+g_storage.get("openurl");g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_download_folder"));a&&a.jqmShow()}}});$("div#btnRename").click(function(){if(g_select_array.length==
1){var a=g_select_array[0].title,b=g_select_array[0].uhref,c=g_select_array[0].isdir,h=$("div#modalWindow");g_modal_url="/smb/css/rename.html?o="+a+"&f="+b+"&d="+c;g_modal_window_width=500;g_modal_window_height=80;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_rename"));h&&h.jqmShow()}});$("div#btnLock").click(function(){alert(myencodeURI("("));g_select_array.length==1&&client.LOCK(g_select_array[0].uhref,"",function(a,b,c){a!="201"?alert("Error unlocking: "+b):(g_current_locktoken=
getLockToken(c),alert("locktoken: "+g_current_locktoken))},null,"exclusive","write",0,3)});$("div#btnUnLock").click(function(){g_select_array.length==1&&client.UNLOCK(g_select_array[0].uhref,g_current_locktoken,function(a){alert(a)})});$("div#btnChangeUser").click(function(){if(confirm(m.getString("msg_changeuser_confirm"))==!0){$("#main_right_container #fileview").empty();var a=g_storage.get("openurl");client.LOGOUT(a,function(b){b==200&&doPROPFIND(a)})}});$("div#btnSelect").click(function(){g_select_mode=
1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("#btnPlayImage").css("display","none");var a=$("div#btnNewDir").width()+$("div#btnUpload").width()+5;$("div#btnCancelSelect").css("display","block");$("div#btnCancelSelect").css("right",a);g_on_button_animation=1;$("div#btnCancelSelect").animate({right:5},500,function(){$(".selectHintDiv").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});
adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))});g_on_button_animation=0})});$("div#btnSelect2").click(function(){g_select_mode=1;$(".selectHintDiv").css("display","block");$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnCancelSelect").css("display",
"block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))})});$("div#btnCancelSelect").click(function(){$("div#btnCancelSelect").css("display","none");$("div#btnSelect").css("display","block");$("div#btnSelect").css("right",5);g_on_button_animation=1;$("div#btnSelect").animate({right:85},
500,function(){cancelSelectMode();$("div#btnSelect").css("right",5);g_on_button_animation=0})});$("#btnUpload").click(function(){closePopupmenu();var a="<div class='popupmenu' id='popupmenu'>";a+="<div class='menuitem' id='uploadfile'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";
a+="<div style='-webkit-user-select: none;'>"+m.getString("title_upload_file")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="<div class='menuitem' id='uploadfolder'>";a+="<div class='menuitem-content' style='-webkit-user-select: none;'>";a+="<span class='menuitem-icon a-inline-block' style='-webkit-user-select: none;'>&nbsp;</span>";a+="<span class='menuitem-container a-inline-block' style='-webkit-user-select: none;'>";a+="<span class='menuitem-caption a-inline-block' style='-webkit-user-select: none;'>";
a+="<div style='-webkit-user-select: none;'>"+m.getString("title_upload_folder")+"</div>";a+="</span>";a+="</span>";a+="</div>";a+="</div>";a+="</div>";$(a).appendTo("body");$(".popupmenu").css("left",g_mouse_x-$(".popupmenu").width()+"px");$(".popupmenu").css("top",g_mouse_y+"px");$("#uploadfile").click(function(){if(isBrowser("msie")&&getInternetExplorerVersion()<=9){var a=$("div#modalWindow");g_modal_url="/smb/css/upload_file.html";g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display",
"none");$("#jqmTitleText").text(m.getString("title_upload_file"));a&&a.jqmShow()}else g_upload_mode=1,$("div#btnNewDir").css("display","none"),$("div#btnUpload").css("display","none"),$("div#btnSelect").css("display","none"),$("#btnPlayImage").css("display","none"),$("#upload_panel").css("display","block"),$("#upload_panel").css("left","1999px"),$("#upload_panel").animate({left:"0px"},"slow"),a=addPathSlash(g_storage.get("openurl")),$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a+
"&d=1"),$("#function_help").text(m.getString("msg_uploadmode_help")),adjustLayout();closePopupmenu()});$("#uploadfolder").click(function(){if(isBrowser("chrome")){g_upload_mode=1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("#btnPlayImage").css("display","none");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},"slow");var a=addPathSlash(g_storage.get("openurl"));
$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a+"&d=2");$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout();closePopupmenu()}else a=$("div#modalWindow"),g_modal_url="/smb/css/upload_folder.html",g_modal_window_width=600,g_modal_window_height=150,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_upload_folder")),a&&a.jqmShow()});return!1});$("#btnUpload2").click(function(){g_upload_mode=1;$("div#btnNewDir").css("display","none");
$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("#btnPlayImage").css("display","none");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},"slow");var a=addPathSlash(g_storage.get("openurl"));$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a);$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout()});$("#btnCancelUpload").click(closeUploadPanel);$("div#hostview").scroll(function(){g_storage.set("hostviewscrollTop",
$(this).scrollTop())});$("div#fileview").scroll(function(){g_storage.set("contentscrollLeft",$(this).scrollLeft());g_storage.set("contentscrollTop",$(this).scrollTop())});$(".navigation#lan dd a").click(function(){if(confirmCancelUploadFile()!=0){var a=$(this).attr("id");g_storage.set("lan",a);window.location.reload()}});$(".navigation#setting dd a").click(function(){var a=$(this).attr("id");if(a=="logout")confirmCancelUploadFile()!=0&&(a=confirm(m.getString("msg_logout_confirm")),a==!0&&doLOGOUT());
else if(a=="favorite")addtoFavorite();else if(a=="config"){var b=g_storage.get("http_enable"),c=g_storage.get("misc_http_enable"),h=g_storage.get("misc_http_port"),f=g_storage.get("misc_https_port"),g=window.location.host,i="http",a=h;c==0&&!isPrivateIP()?alert(m.getString("msg_no_config")):(b=="0"?(i="http",a=h):b=="1"&&(i="https",a=f),isPrivateIP()?b=i+"://"+g.split(":")[0]:(b=i+"://"+g.split(":")[0],a!=""&&(b+=":"+a)),window.location=b)}else a=="help"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_window_height=
b[1]-30,g_modal_window_width=g_modal_window_height*1.28,g_modal_window_width>b[0]&&(g_modal_window_width=b[0],g_modal_window_height=g_modal_window_width*0.78125),g_modal_url="/smb/css/help.html?showbutton=1",$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_help")),a&&a.jqmShow()):a=="rescan_samba"?confirmCancelUploadFile()!=0&&(a=confirm(m.getString("title_desc_rescan")),a==!0&&doRescanSamba()):a=="sharelink"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_url="/smb/css/setting.html?p=1&s=1",
g_modal_window_width=800,g_modal_window_height=b[1]-30,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_setting")),a&&a.jqmShow()):a=="version"?(a=$("div#modalWindow"),b=getPageSize(),g_modal_url="/smb/css/setting.html?p=2&s=1",g_modal_window_width=800,g_modal_window_height=b[1]-30,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_setting")),a&&a.jqmShow()):a=="test"&&client.GETROUTERINFO("/AICLOUD306106790/AiCloud",function(a,b,c){a==200&&
(a=parseXml(c),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),g_storage.set("https_port",a.find("https_port").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",String(a.find("misc_http_port").text()).replace("\n","")),g_storage.set("last_login_info",a.find("last_login_info").text()),g_storage.set("ddns_host_name",a.find("ddns_host_name").text()),g_storage.set("router_version",
a.find("version").text()),g_storage.set("wan_ip",a.find("wan_ip").text()),a=g_storage.get("last_login_info"),a!=""&&a!=void 0&&(a=String(a).split(">"),a=m.getString("title_logininfo")+a[1]+", "+m.getString("title_ip")+a[2],$("#login_info").text(a)))})});$(".navigation#refresh dt a").click(function(){if(confirmCancelUploadFile()!=0){var a=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){a=a==void 0?"/":a;a!="/"&&doPROPFIND(a)},0)}});$(".themes_ctrl").click(function(){if(confirmCancelUploadFile()!=
0){var a=$(this).attr("id");g_storage.setl("skin",a);window.location.reload()}});$("#btnPlayImage").click(function(){openImageViewer()});$("div#logo").click(function(){g_fileview_only!=1&&doPROPFIND("/",function(){g_storage.set("openhostuid","");window.location.reload()},0)});$(window).resize(adjustLayout)});window.onbeforeunload=function(c){if(g_storage.get("isOnUploadFile")==1){var b=m.getString("msg_confirm_cancel_upload");if(c=c||window.event)c.returnValue=b;return b}};
window.onunload=function(){g_storage.get("isOnUploadFile")==1&&$("#upload_panel iframe")[0].contentWindow.stop_upload()};
