var g_support_html5=0,g_reload_page=1,m=new lang,g_storage=new myStorage,g_listview=g_storage.get("listview")==void 0?0:g_storage.get("listview"),g_modal_url,g_modal_window_width=200,g_modal_window_height=100,timer_idle,g_show_modal=0,g_time_out=9E5,g_time_count=0,g_select_mode=0,g_select_array,g_upload_mode=0,g_folder_array,g_file_array,g_opening_uid="",g_on_button_animation=0,client=new davlib.DavClient;client.initialize();
g_support_html5=window.File&&window.FileReader&&window.FileList&&window.Blob?1:0;function parseXml(a){if(jQuery.browser.msie){var d=new ActiveXObject("Microsoft.XMLDOM");d.loadXML(a);a=d}return a}function getUrlVars(){for(var a=[],d,b=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<b.length;e++)d=b[e].split("="),a.push(d[0]),a[d[0]]=d[1];return a}function getFileExt(a){a=/^.+\.([^.]+)$/.exec(a);return a==null?"":a[1].toLowerCase()}
function addPathSlash(a){if(a.lastIndexOf("/")==a.length-1)return a;a+="/";return a}function size_format(a){for(var d=0;a>=1024;)a/=1024,++d;return a.toFixed(1)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][d]}function mydecodeURI(a){a=decodeURI(a);a=String(a).replace("%22",'"');a=String(a).replace("%23","#");a=String(a).replace("%24","$");a=String(a).replace("%25","%");a=String(a).replace("%26","&");a=String(a).replace("%2b","+");return a=String(a).replace("%40","@")}
function myencodeURI(a){a=String(a).replace("%","%25");a=String(a).replace('"',"%22");a=String(a).replace("#","%23");a=String(a).replace("$","%24");a=String(a).replace("&","%26");a=String(a).replace("+","%2b");a=String(a).replace("@","%40");return a=encodeURI(a)}function isPrivateIP(){var a=window.location.host;return a.indexOf("192.168")==0||a.indexOf("127")==0||a.indexOf("10")==0?1:0}function isWinOS(){return navigator.appVersion.toLowerCase().indexOf("win")!=-1?1:0}
function isMacOS(){var a=navigator.appVersion.toLowerCase();return a.indexOf("mac")!=-1&&a.indexOf("iphone")==-1&&a.indexOf("ipad")==-1&&a.indexOf("ipod")==-1?1:0}function isBrowser(a){return navigator.userAgent.toLowerCase().indexOf(a)!=-1?1:0}
function openImageViewer(a){for(var d=[],b=0;b<g_file_array.length;b++){var e=getFileExt(g_file_array[b].href);(e=="jpg"||e=="jpeg"||e=="png"||e=="gif")&&d.push(g_file_array[b])}if(d.length==0)alert(m.getString("msg_no_image_list"));else{for(b=e=0;b<d.length;b++)a==d[b].href&&(e=b);a="";b=getPageSize();a+='<div id="image_slide_show" class="barousel" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: '+b[0]/2+"px; top: "+b[1]/2+'px; z-index: 2999;">';a+='<div class="barousel_image">';
for(b=0;b<d.length;b++){var c=window.location.protocol+"//"+window.location.host+d[b].href;a+=b==e?'<img src="" path="'+c+'" alt="" class="default"/>':'<img src="" path="'+c+'" alt="" class=""/>'}a+="</div>";a+='<div class="barousel_nav">';a+='<div class="barousel_content transparent" style="display: block; ">';for(b=0;b<d.length;b++)a+='<div class="',b==e&&(a+="default"),a+='" style="display: none; ">',a+='<p class="header">'+d[b].name+"</p>",a+="</div>";a+="</div>";a+="</div>";a+="</div>";$(a).animate({width:"100%",
height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({navType:2,manualCarousel:1,contentResize:0,startIndex:e})}}function doRescanSamba(){var a=addPathSlash(g_storage.get("openurl"));closeJqmWindow(0);showHideLoadStatus(!0);client.RESCANSMBPC(a,function(a){a[0]==2&&(g_storage.set("HostList",""),doPROPFIND("/"))})}
function doMKDIR(a){var d=addPathSlash(g_storage.get("openurl")),b=d+myencodeURI(a),e=0;$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&a==$(this).attr("title")&&(e=1,alert(m.getString("folder_already_exist_msg")))});e!=1&&client.MKCOL(b,function(a){a[0]==2?(doPROPFIND(d),closeJqmWindow(0)):alert(m.getString(a))})}
function doRENAME(a,d){var b=0,e=addPathSlash(g_storage.get("openurl")),c=e+encodeURI(d);$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&d==$(this).attr("title")&&(b=1,alert(m.getString("folder_already_exist_msg")))});b!=1&&client.MOVE(a,c,function(b){b[0]==2?(doPROPFIND(e),closeJqmWindow(0)):alert(m.getString(b)+" : "+decodeURI(a))})}function getFileViewHeight(){return $("#fileview").height()}
function closeUploadPanel(a){g_upload_mode=0;g_reload_page=a;g_storage.set("stopLogoutTimer","0");$("div#btnNewDir").css("display","block");g_support_html5==1&&$("div#btnUpload").css("display","block");$("div#btnSelect").css("display","block");$("#btnPlayImage").css("display","block");$("div#btnCancelUpload").css("display","none");$("#function_help").text("");$("#upload_panel").animate({left:"1999px"},"slow",null,function(){$("#upload_panel").css("display","none");adjustLayout()});a==1&&(a=addPathSlash(g_storage.get("openurl")),
doPROPFIND(a))}
function cancelSelectMode(){g_select_mode!=0&&(g_select_mode=0,g_select_array=null,$("#btnDownload").addClass("disable"),$("#btnShareLink").addClass("disable"),$("#btnDeleteSel").addClass("disable"),$("#btnRename").addClass("disable"),$("div#btnNewDir").css("display","block"),g_support_html5==1&&$("div#btnUpload").css("display","block"),$("div#btnSelect").css("display","block"),$("#btnPlayImage").css("display","block"),$("div#btnCancelSelect").css("display","none"),$(".selectDiv").css("display","none"),
$(".selectHintDiv").css("display","none"),$("#fileview #fileviewicon").each(function(){$(this).removeClass("select")}),$("#function_help").text(""),adjustLayout(),$("#button_panel").animate({left:"1999px"},"slow",null,function(){}))}
function adjustLayout(){var a=getPageSize(),d=a[1]-$("#header_region").height()-$("#bottom_region").height();$("#main_region").css("height",d);a=a[0];$("#main_region #main_right_region").css("width",a-$("#main_region #main_left_region").width());a=$("#main_left_region").height()-$("#infobar").height()-$("#settingbar").height();d=Math.max(Math.floor(a/40),1)*40;$("#hostview").css("height",d);$("#settingbar").css("padding-top",a-d);var b=0;$("#toolbar .albutton").each(function(){$(this).css("display")==
"block"&&(b+=$(this).width())});$("#urlregion-url").css("width",$("#toolbar").width()-b-20);createOpenUrlUI(g_storage.get("openurl"));a=g_select_mode==1?$("#main_right_container").height()-$("#infobar").height()-$("#button_panel").height():$("#main_right_container").height()-$("#infobar").height();$("#fileview").css("height",a);$("#function_help").css("left",$("#main_left_region").width())}
function closeJqmWindow(a){g_reload_page=a;a=$("div#modalWindow");$("iframe",a).attr("src","");a&&a.jqmHide();showHideLoadStatus(!1)}function fullscreenJqmWindow(){var a=$("div#modalWindow");a&&(a.css("left","0px"),a.css("top","0px"),a.css("width",window.width+"px"),a.css("height",window.height+"px"))}function doLOGOUT(){doPROPFIND("/",function(){addPathSlash(g_storage.get("openurl"));client.LOGOUT("/",function(a){a[0]==2&&(g_storage.set("openhostuid","0"),window.location.reload())})},0)}
function resetTimer(){clearInterval(timer_idle);g_time_count=0;timer_idle=setInterval(function(){g_storage.get("stopLogoutTimer")=="1"||g_show_modal==1?g_time_count=0:(g_time_count++,g_time_count*1E3>g_time_out&&(g_time_count=0,doLOGOUT()))},1E3)}String.prototype.width=function(a){var a=a||"12px arial",a=$("<div>"+this+"</div>").css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:a}).appendTo($("body")),d=a.width();a.remove();return d};
function createOpenUrlUI(a){a==void 0&&(a="/");var d=mydecodeURI(a),b="",e="",c="",f=$("#urlregion-url").width();if(d!="/")for(var d=d.split("/"),a=a.split("/"),g=0;g<d.length;g++)if(d[g]!=""){e+="/"+a[g];c+=" / <a id='url_path' uhref='"+e+"'>"+d[g]+"</a>";if(String(c).width($("p#openurl").css("font"))>f){b+=" / ...";break}b+=" / <a id='url_path' uhref='"+e+"'>"+d[g]+"</a>";c=b}$("p#openurl").empty();$("p#openurl").append(b);$("a#url_path").click(function(){doPROPFIND($(this).attr("uhref"))})}
function doPROPFIND(a,d,b){if(client!=null){showHideLoadStatus(!0);cancelSelectMode();closeUploadPanel();try{client.PROPFIND(a,b,function(b,e,g){if(b){if(b==207){g_folder_array=[];g_file_array=[];if(window.DOMParser)b=new DOMParser,b=b.parseFromString(g,"text/xml");else if(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(g),!b.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var l,n,i,h,q,e=b.documentElement.childNodes,g=b.documentElement.getAttribute("qtype");
b.documentElement.getAttribute("readonly");b.documentElement.getAttribute("ruser");b.documentElement.getAttribute("computername");b=b.documentElement.getAttribute("isusb");for(l=0;l<e.length;l++){var o="",u="",v="",p="",s="",w="",x="",y="",z="",A="",B="",C="",D="",k,r=e[l].childNodes;for(n=0;n<r.length;n++)if(r[n].nodeType==1&&r[n].nodeName=="D:propstat"){var E=r[n].childNodes;for(i=0;i<E.length;i++)if(E[i].nodeName=="D:prop"){var j=E[i].childNodes;for(h=0;h<j.length;h++)if(!(j[h].childNodes.length<=
0))if(j[h].nodeName=="D:getcontenttype")u=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getuniqueid")v=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getonline")w=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getlastmodified")x=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getcontentlength")y=String(size_format(parseInt(j[h].childNodes[0].nodeValue)));else if(j[h].nodeName=="D:getmac")A=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName==
"D:getip")z=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:gettype")B=String(j[h].childNodes[0].nodeValue);else if(j[h].nodeName=="D:getattr"){var t=j[h].childNodes;for(q=0;q<t.length;q++)if(t[q].nodeName=="D:readonly")C=t[q].childNodes[0].nodeValue;else if(t[q].nodeName=="D:hidden")D=t[q].childNodes[0].nodeValue}}}else r[n].nodeType==1&&r[n].nodeName=="D:href"&&(o=String(r[n].childNodes[0].nodeValue),i="",o.match(/^http/)&&(i=window.location.protocol+"//"+window.location.host),h=
i+addPathSlash(a),o!=h?(p=a,o=o.replace(i,""),p=o.replace(addPathSlash(p),""),p!=""?(k=p,s=p=mydecodeURI(p),i=g_listview==0?12:45,s.length>i&&(s=s.substring(0,i)+"...")):o=""):o="");o!=""&&(u=="httpd/unix-directory"?g_folder_array.push({contenttype:u,href:o,name:p,uname:k,shortname:s,online:w,time:x,size:y,ip:z,mac:A,uid:v,type:B,freadonly:C,fhidden:D}):g_file_array.push({contenttype:u,href:o,name:p,uname:k,shortname:s,online:w,time:x,size:y,ip:z,mac:A,uid:v,type:B,freadonly:C,fhidden:D}))}g_folder_array.sort(sortByName);
g_file_array.sort(sortByName);for(k=0;k<g_folder_array.length;k++)if(g_folder_array[k].type=="usbdisk"){arraymove(g_folder_array,k,0);break}k=addPathSlash(a);k!="/"&&(k=k.substring(0,k.length-1),k=k.substring(0,k.lastIndexOf("/")),k==""&&(k="/"));createHostList(g,g_folder_array);createThumbView(g,k,g_folder_array,g_file_array);g==0&&g_select_mode==0?($("#btnUpload").css("display","block"),$("#btnSelect").css("display","block"),$("#btnNewDir").css("display","block"),$("#btnPlayImage").css("display",
"block")):($("#btnUpload").css("display","none"),$("#btnSelect").css("display","none"),$("#btnNewDir").css("display","none"),$("#btnPlayImage").css("display","none"));g_support_html5==0&&$("#btnUpload").css("display","none");g_select_mode==1&&$("#btnCancelSelect").css("display","block");g_upload_mode==1&&$("#btnCancelUpload").css("display","block");g==1&&b==0?$("#btnChangeUser").css("display","block"):$("#btnChangeUser").css("display","none");g_storage.set("openurl",a);$("div#hostview").scrollTop(g_storage.get("hostviewscrollTop"));
$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));adjustLayout();closeJqmWindow(0);d!=void 0&&d()}else b==501?doPROPFIND(a):b==401?setTimeout(function(){var b=$("div#modalWindow"),c=b.css("display");g_modal_url="/smb/css/login.html?v="+a;g_modal_window_width=365;g_modal_window_height=150;a=="/"?$("#jqmTitleText").text(m.getString("title_login")+" - AiCloud"):$("#jqmTitleText").text(m.getString("title_login")+" - "+a.substring(0,
35));c=="block"&&$("#jqmMsgText").text(m.getString("msg_passerror"));$("#jqmMsg").css("display",c);b&&b.jqmShow()},1E3):alert(m.getString(b));showHideLoadStatus(!1)}},null,1),resetTimer()}catch(e){alert("catch error: "+e)}}}function doLOGIN(a,d){doPROPFIND(a,function(){g_storage.set("openhostuid",g_opening_uid);$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).css("background-color","#009583"):$(this).css("background-color","#014051")});g_opening_uid=""},d)}
function createHostList(a,d){var b="";$("#hostview").empty();var e=g_storage.get("HostList")?g_storage.get("HostList").split(/,/):[];if(a==2)for(var c=0;c<d.length;c++){var f=d[c].href+"|"+d[c].name+"|"+d[c].online+"|"+d[c].ip+"|"+d[c].mac+"|"+d[c].uid+"|"+d[c].freadonly+"|"+d[c].fhidden+"|"+d[c].type;e.contains(f)||e.push(f);g_storage.set("HostList",e.join(","))}for(c=0;c<e.length;c++)f=e[c].split("|"),b+="<div class='host_item unselectable",f[2]==0&&(b+=" offline"),b+="' uhref='",b+=f[0],b+="' title='",
b+=f[1]+" - "+f[3],b+="' online='",b+=f[2],b+="' isdir='1'",b+=" ip='",b+=f[3],b+="' mac='",b+=f[4],b+="' uid='",b+=f[5],b+="' freadonly='",b+=f[6],b+="' fhidden='",b+=f[7],b+=f[8]=="usbdisk"?"' isusb='1'":"' isusb='0'",b+=">",b+="<div id='hosticon' class='sicon "+f[8],f[2]==0&&(b+="off"),b+="'/>",b+="<div id='hostname' class='unselectable'>",b+="<p>",b+=f[1],f[2]==0&&(b+="("+m.getString("title_offline")+")"),b+="</p>",b+="</div>",b+="</div>";$("#hostview").append(b);var g=g_storage.get("openhostuid");
$("#hostview .host_item").each(function(){$(this).attr("uid")==g?$(this).css("background-color","#009583"):$(this).css("background-color","#014051")});$("#hostview .host_item").click(function(){if($(this).attr("online")==0)confirm(m.getString("wol_msg"))==!0&&client.WOL("/",$(this).attr("mac"),function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))});else{g_opening_uid=$(this).attr("uid");var a=$(this).attr("uhref");g_storage.set("opentype",$(this).attr("type")=="usbdisk"?
"1":"0");doPROPFIND(a,function(){g_storage.set("openhostuid",g_opening_uid);$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).css("background-color","#009583"):$(this).css("background-color","#014051")});g_opening_uid=""},null)}})}
function createThumbView(a,d,b,e){var c="";$("#main_right_container #fileview").empty();if(a!=2){a==0&&(c+='<div class="albumDiv">',c+='<table class="thumb-table-parent">',c+="<tbody>",c+="<tr><td>",c+='<div class="picDiv" isParent="1" popupmenu="0" uhref="',c+=d,c+='">',c+='<div class="parentDiv bicon"></div></div>',c+="</td></tr>",c+="<tr><td>",c+='<div class="albuminfo">',c+='<a id="list_item" qtype="1" isdir="1" uhref="',c+=d,c+='" title="'+m.getString("btn_prevpage")+'" online="0">'+m.getString("btn_prevpage"),
c+="</a>",c+="</div>",c+="</td></tr>",c+="</tbody>",c+="</table>",c+="</div>");for(d=0;d<b.length;d++){var f=m.getString("table_filename")+": "+b[d].name+"\n"+m.getString("table_time")+": "+b[d].time;c+='<div class="albumDiv" ';c+=' title="';c+=f;c+='">';c+='<table class="thumb-table-parent">';c+="<tbody>";c+="<tr><td>";c+='<div class="picDiv" popupmenu="';c+=a=="0"?"1":"0";c+='" uhref="';c+=b[d].href;c+='">';c+=a=="2"?b[d].type=="usbdisk"?'<div id="fileviewicon" class="usbDiv bicon">':b[d].online==
"1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':'<div id="fileviewicon" class="folderDiv bicon">';c+='<div class="selectDiv sicon"></div>';c+='<div class="selectHintDiv sicon"></div>';c+="</div></div>";c+="</td></tr>";c+="<tr><td>";c+='<div class="albuminfo">';c+='<a id="list_item" qtype="';c+=a;c+='" isdir="1" uhref="';c+=b[d].href;c+='" title="';c+=b[d].name;c+='" online="';c+=b[d].online;c+='" ip="" mac="';c+=b[d].mac;c+='" uid="';
c+=b[d].uid;c+='" freadonly="';c+=b[d].freadonly;c+='" fhidden="';c+=b[d].fhidden;c+=b[d].type=="usbdisk"?'" isusb="1"':'" isusb="0"';c+='">';c+=b[d].shortname;b[d].online=="0"&&a=="2"&&(c+="("+m.getString("title_offline")+")");c+="</a>";c+="</div>";c+="</td></tr>";c+="</tbody>";c+="</table>";c+="</div>"}for(d=0;d<e.length;d++)f=m.getString("table_filename")+": "+e[d].name+"\n"+m.getString("table_time")+": "+e[d].time+"\n"+m.getString("table_size")+": "+e[d].size,c+='<div class="albumDiv"',c+=' title="',
c+=f,c+='">',c+='<table class="thumb-table-parent">',c+="<tbody>",b=getFileExt(String(e[d].href)),b.length>5&&(b=""),c+="<tr><td>",c+=a=="0"?'<div class="picDiv" popupmenu="1" uhref="':'<div class="picDiv" popupmenu="0" uhref="',c+=e[d].href,c+='">',c+=b=="jpg"||b=="jpeg"||b=="png"||b=="gif"||b=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':b=="mp3"||b=="m4a"||b=="m4r"||b=="wav"?'<div id="fileviewicon" class="audiofileDiv bicon">':b=="mp4"||b=="rmvb"||b=="m4v"||b=="wmv"||b=="avi"||b=="mpg"||
b=="mpeg"||b=="mkv"||b=="mov"||b=="flv"||b=="3gp"||b=="m2v"||b=="rm"?'<div id="fileviewicon" class="videofileDiv bicon">':b=="doc"||b=="docx"?'<div id="fileviewicon" class="docfileDiv bicon">':b=="ppt"||b=="pptx"?'<div id="fileviewicon" class="pptfileDiv bicon">':b=="xls"||b=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv bicon">':b=="pdf"?'<div id="fileviewicon" class="pdffileDiv bicon">':'<div id="fileviewicon" class="fileDiv bicon">',c+='<div class="selectDiv sicon"></div>',c+='<div class="selectHintDiv sicon"></div>',
c+="</div></div>",c+="</td></tr>",c+="<tr><td>",c+='<div class="albuminfo" style="font-size:80%">',c+='<a id="list_item" qtype="1" isdir="0" uhref="',c+=e[d].href,c+='" title="',c+=e[d].name,c+='" uid="',c+=e[d].uid,c+='" ext="',c+=b,c+='" freadonly="',c+=e[d].freadonly,c+='" fhidden="',c+=e[d].fhidden,c+='">',c+=e[d].shortname,c+="</a>",c+="</div>",c+="</td></tr>",c+="</tbody>",c+="</table>",c+="</div>";$("#main_right_container #fileview").append(c);$(".picDiv").mousedown(onMouseDownPicDIVHandler)}}
function sortByName(a,d){var b=a.name.toLowerCase(),e=d.name.toLowerCase();return b<e?-1:b>e?1:0}function arraymove(a,d,b){var e=a[d];a.splice(d,1);a.splice(b,0,e)}function getPageSize(){var a=$(window).width(),d=$(window).height();return[a,d]}function showHideLoadStatus(a){a?$("#loading").css("display","block"):$("#loading").css("display","none")}
function onMouseDownPicDIVHandler(a){if(a.button==2||g_on_button_animation==1)return!1;if(g_select_mode==1)if($(this).attr("isParent")==1)cancelSelectMode(),openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"));else{$(this).find(".selectDiv").css("display")=="none"?($(this).find(".selectDiv").css("display","block"),$(this).find(".selectHintDiv").css("display","none")):($(this).find(".selectDiv").css("display","none"),$(this).find(".selectHintDiv").css("display","block"));g_select_array=
null;g_select_array=[];var d=0,b=0;$("#fileview").find(".albumDiv").each(function(){if($(this).find(".selectDiv").css("display")=="block"){var a=$(this).find("#list_item").attr("uhref"),c=$(this).find("#list_item").attr("isdir"),f=$(this).find("#list_item").attr("title");c==1?b++:d++;g_select_array.push({isdir:c,uhref:a,title:f})}});d>=1?$("#btnDownload").removeClass("disable"):$("#btnDownload").addClass("disable");d>0?$("#btnShareLink").removeClass("disable"):$("#btnShareLink").addClass("disable");
d>0||b>0?$("#btnDeleteSel").removeClass("disable"):$("#btnDeleteSel").addClass("disable");d+b==1?$("#btnRename").removeClass("disable"):$("#btnRename").addClass("disable")}else openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}function getInternetExplorerVersion(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a}
function openSelItem(a){var d=a.attr("uhref"),b=a.attr("qtype"),e=a.attr("isdir"),c=a.attr("isusb"),f=a.attr("uhref"),g=a.attr("title");g_storage.set("openuid",a.attr("uid"));g_storage.set("opentype",c);if(b==2&&a.attr("online")==0)confirm(m.getString("wol_msg"))==!0&&(d=a.attr("mac"),client.WOL("/",d,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}));else if(e=="1")doPROPFIND(d,null,null);else{a=getFileExt(d);b=g_storage.get("webdav_mode");if(a=="mp4"||a=="m4v"||
a=="wmv"||a=="avi"||a=="rmvb"||a=="rm"||a=="mpg"||a=="mpeg"||a=="mkv"||a=="mov"||a=="flv")if((b==0||b==2)&&isWinOS())if(isBrowser("msie")&&getInternetExplorerVersion()<=8)alert(m.getString("msg_vlcsupport"));else{var l=$("div#modalWindow"),g=encodeURI(g);this_url=f.substring(0,f.lastIndexOf("/"));client.GSL(this_url,this_url,g,86400,0,function(a,b,c){a==200&&(a=parseXml(c),a=$(a).find("sharelink").text(),b="",a=window.location.protocol+"//"+window.location.host+"/"+a,b="/smb/css/vlc_video.html?v="+
a,b+="&showbutton=1",g_modal_url=b,g_modal_window_width=655,g_modal_window_height=480,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_videoplayer")),l&&l.jqmShow())});return}if(a=="mp3")l=$("div#modalWindow"),g_modal_url="/smb/css/audio.html?a="+d,g_modal_window_width=422,g_modal_window_height=120,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_audioplayer")),l&&l.jqmShow();else{if(a=="doc"||a=="docx"||a=="ppt"||a=="pptx"||a=="xls"||a=="xlsx"||
a=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){g=encodeURI(g);this_url=f.substring(0,f.lastIndexOf("/"));client.GSL(this_url,this_url,g,86400,0,function(a,b,c){a==200&&(a=parseXml(c),a=$(a).find("sharelink").text(),b="",a=window.location.protocol+"//"+window.location.host+"/"+a,window.open("https://docs.google.com/viewer?url="+a))});return}a=="jpg"||a=="jpeg"||a=="png"||a=="gif"?openImageViewer(d):window.open(d)}}}
function createLayout(){var a=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),d=g_storage.get("lan")==void 0?a:g_storage.get("lan");m.setLanguage(d);a="";a+="<div id='header_region' class='unselectable' width='100%' border='0'>";a+="<div id='logo'></div>";a+="<div id='user'>Welcome home, <span id='username'>admin</span></div>";a+="<div id='loading'><img src='/smb/css/load.gif'/><div><span>Loading...</span></div></div>";a+="<div class='albutton toolbar-button-right' id='btnHelp'><div class='ticon'></div></div>";
a+="</div>";a+="<div id='main_region' class='unselectable'>";a+="<div id='main_left_region' class='unselectable'>";a+="<div id='infobar' class='unselectable'></div>";a+="<div id='hostview' class='unselectable'></div>";a+="<div id='settingbar' class='unselectable'>";a+="<div id='buttonpanel' class='unselectable'>";a+="<div class='toolbar-button-left' style='width:40px;height:40px;background-color:#FFC000'></div>";a+="<div class='albutton toolbar-button-left' id='btnLogout' style='background-color:#0F4373'><div class='ticon'></div></div>";
a+="<div class='albutton toolbar-button-left' id='btnConfig' style='background-color:#578EA2'><div class='ticon'></div></div>";a+="<div class='toolbar-button-left' style='width:40px;height:40px;background-color:#008F6D'></div>";a+="<div class='albutton toolbar-button-left' id='btnSetting' style='background-color:#6A6A6A'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-left' id='btnRefresh' style='background-color:#346948'><div class='ticon'></div></div>";a+="</div>";a+="</div>";
a+="</div>";a+="<div id='main_right_region' class='unselectable'>";a+="<div id='main_right_container' class='unselectable'>";a+="<div id='infobar' class='unselectable'>";a+="<div id='toolbar' class='unselectable'>";a+="<div id='urlregion-url'>";a+="<p id='openurl' align='left' width='150' style='padding-left:10px' ></p>";a+="</div>";a+="<div class='albutton toolbar-button-right' id='btnUpload' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnPlayImage' style='display:none'><div class='ticon'></div></div>";
a+="<div class='albutton toolbar-button-right' id='btnNewDir' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnSelect' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnCancelSelect' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnCancelUpload' style='display:none'><div class='ticon'></div></div>";a+="<div class='albutton toolbar-button-right' id='btnChangeUser' style='display:none'><div class='ticon'></div></div>";
a+="</div>";a+="</div>";a+="<div id='fileview' class='unselectable'></div>";a+="<div id='button_panel' class='unselectable'>";a+="<div class='abbutton toolbar-button-right disable' id='btnShareLink' style='display:block'><div class='ticon'></div></div>";a+="<div class='abbutton toolbar-button-right disable' id='btnDeleteSel' style='display:block'><div class='ticon'></div></div>";a+="<div class='abbutton toolbar-button-right disable' id='btnDownload' style='display:block'><div class='ticon'></div></div>";
a+="<div class='abbutton toolbar-button-right disable' id='btnRename' style='display:block'><div class='ticon'></div></div>";a+="</div>";a+="<div id='upload_panel' class='unselectable'>";a+="<div style='position:absolute;width:98%;height:100%;padding:10px'>";a+="<iframe src='' width='100%' height='100%' frameborder='0'/>";a+="</div>";a+="</div>";a+="</div>";a+="</div>";a+="</div>";a+="<div id='bottom_region' class='unselectable'>";a+="<span id='function_help'></span>";a+="<div class='lan'>";a+="<span>"+
m.getString("title_language")+"</span>";a+="<select id='menu_lan'>";a+="<option value='en-us' selected>"+m.getString("lan_en")+"</option>";a+="<option value='zh-tw'>"+m.getString("lan_zh-tw")+"</option>";a+="</select>";a+="</div>";a+="</div>";a+="<div id='modalWindow' class='jqmWindow'>";a+="<div id='jqmTitle'>";a+="<span id='jqmTitleText'></span>";a+="</div>";a+="<div id='jqmMsg'>";a+="<span id='jqmMsgText'></span>";a+="</div>";a+="<iframe id='jqmContent' src='' frameborder='0'>";a+="</div>";$("body").empty();
$("body").append(a);$("#menu_lan").children().each(function(){$(this).val()==d&&$(this).attr("selected","true")});$("span#username").click(function(){confirm(m.getString("msg_logout_confirm"))==!0&&doLOGOUT()});$("#btnHelp").attr("title",m.getString("title_help"));$("#btnLogout").attr("title",m.getString("title_logout"));$("#btnConfig").attr("title",m.getString("btn_config"));$("#btnUpload").attr("title",m.getString("btn_upload"));$("#btnCancelUpload").attr("title",m.getString("btn_cancelupload"));
$("#btnSelect").attr("title",m.getString("btn_select"));$("#btnCancelSelect").attr("title",m.getString("btn_cancelselect"));$("#btnNewDir").attr("title",m.getString("btn_newdir"));$("#btnShareLink").attr("title",m.getString("btn_sharelink"));$("#btnDeleteSel").attr("title",m.getString("btn_delselect"));$("#btnDownload").attr("title",m.getString("func_download"));$("#btnRename").attr("title",m.getString("btn_rename"));$("#btnSetting").attr("title",m.getString("title_setting"));$("#btnRefresh").attr("title",
m.getString("btn_refresh"))}
$(document).ready(function(){function a(b){b&&b[0]!=2?alert(m.getString(b)+" : "+decodeURI(g_selected_files[0])):(g_selected_files.splice(0,1),g_selected_files.length<=0?(b=addPathSlash(g_storage.get("openurl")),doPROPFIND(b)):client.DELETE(g_selected_files[0],a))}document.oncontextmenu=function(){return!1};document.onmousedown=function(){resetTimer()};document.onmousemove=function(){resetTimer()};$(document).keydown(function(a){a.keyCode==27&&(g_select_mode==1?cancelSelectMode():g_upload_mode==1&&
closeUploadPanel(),closeJqmWindow())});g_storage.set("stopLogoutTimer","0");g_storage.set("isOpenModalWindow","0");createLayout();showHideLoadStatus(!1);adjustLayout();(function(){client.GETROUTERINFO("/",function(a,d,c){a==200&&(a=parseXml(c),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),g_storage.set("https_port",a.find("https_port").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",
a.find("misc_http_port").text()))})})();var d=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){d!=void 0&&d!="/"&&doPROPFIND(d);if(g_storage.get("openhostuid")==void 0||g_storage.get("openhostuid")==0){var a="<div id='help_1'>";a+="<div id='help_content'>";a+=m.getString("msg_help");a+="</div>";a+="<div id='help_image'>";a+="</div>";a+="</div>";$("div#fileview").append(a)}},0);$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(a){$(a.w).fadeOut("2000",
function(){a.o.remove();g_show_modal=0;if(g_reload_page==1){var d=addPathSlash(g_storage.get("openurl"));doPROPFIND(d)}})},onShow:function(a){var a=$(a.w),d=$("iframe",a),c=($(document).width()-g_modal_window_width)/2;g_show_modal=1;d.attr("src",g_modal_url);a.css({width:g_modal_window_width,height:g_modal_window_height,left:c,top:-g_modal_window_height,opacity:0}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:c,marginLeft:0,opacity:1},200)}});$("div#btnDeleteSel").click(function(){if(!(g_select_array.length<=
0)&&confirm(m.getString("del_files_msg"))==!0){g_selected_files=null;g_selected_files=[];for(var b=0;b<g_select_array.length;b++)g_selected_files.push(g_select_array[b].uhref);client.DELETE(g_selected_files[0],a)}});$("div#btnNewDir").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/makedir.html";g_modal_window_width=500;g_modal_window_height=100;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_newdir"));a&&a.jqmShow()});$("div#btnRefresh").click(function(){var a=
g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){a=a==void 0?"/":a;a!="/"&&doPROPFIND(a)},0)});$("div#btnLogout").click(function(){confirm(m.getString("msg_logout_confirm"))==!0&&doLOGOUT()});$("div#btnSetting").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/setting.html";g_modal_window_width=600;g_modal_window_height=400;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_setting"));a&&a.jqmShow()});$("div#btnShareLink").click(function(){if(!(g_select_array.length<=
0)){m.getString("email_subject");for(var a="",d="",c="",f=0;f<g_select_array.length;f++){var g=g_select_array[f].title,l=g_select_array[f].uhref,n=window.location.href;g_select_array[f].isdir!=1&&(g=encodeURI(g),d=n=l.substring(0,l.lastIndexOf("/")),c+=g,c+=";")}var f=g_storage.get("webdav_mode"),i=window.location.host;i.indexOf(":")!=-1&&(i=i.substring(0,i.indexOf(":")));i=f==0?"http://"+i+":"+g_storage.get("http_port"):"https://"+i;client.GSL(d,d,c,86400,1,function(c,d,e){if(c==200)if(c=parseXml(e),
c=$(c).find("sharelink").text(),c=="")alert("Fail to parse xml!");else{c=c.split(";");d=c.length;for(e=0;e<d;e++)a+=i+"/"+c[e],e!=d-1&&(a+="<br><br>");c=$("div#modalWindow");g_modal_url="/smb/css/sharelink.html?v="+a;g_modal_window_width=600;g_modal_window_height=500;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_sharelink"));c&&c.jqmShow()}})}});$("div#btnDownload").click(function(){if(!(g_select_array.length<=0))for(var a=0;a<g_select_array.length;a++){var d=g_select_array[a].title,
c=g_select_array[a].uhref,f=window.location.href;g_select_array[a].isdir!=1&&(d=encodeURI(d),f=c.substring(0,c.lastIndexOf("/")),$.fileDownload(f+"/"+d,{successCallback:function(){},failCallback:function(a,b){window.open(b)}}))}});$("div#btnRename").click(function(){if(g_select_array.length==1){var a=g_select_array[0].title,d=g_select_array[0].uhref,c=g_select_array[0].isdir,f=$("div#modalWindow");g_modal_url="/smb/css/rename.html?o="+a+"&f="+d+"&d="+c;g_modal_window_width=500;g_modal_window_height=
100;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_rename"));f&&f.jqmShow()}});$("div#btnChangeUser").click(function(){$("#main_right_container #fileview").empty();var a=g_storage.get("openurl");client.LOGOUT(a,function(d){d==200&&doPROPFIND(a)})});$("div#btnSelect").click(function(){g_select_mode=1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("#btnPlayImage").css("display","none");var a=
$("div#btnNewDir").width()+$("div#btnUpload").width()+5;$("div#btnCancelSelect").css("display","block");$("div#btnCancelSelect").css("right",a);g_on_button_animation=1;$("div#btnCancelSelect").animate({right:5},500,function(){$(".selectHintDiv").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))});
g_on_button_animation=0})});$("div#btnSelect2").click(function(){g_select_mode=1;$(".selectHintDiv").css("display","block");$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnCancelSelect").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},
"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))})});$("div#btnCancelSelect").click(function(){$("div#btnCancelSelect").css("display","none");$("div#btnSelect").css("display","block");$("div#btnSelect").css("right",5);g_on_button_animation=1;$("div#btnSelect").animate({right:85},500,function(){cancelSelectMode();$("div#btnSelect").css("right",5);g_on_button_animation=0})});$("#btnUpload").click(function(){g_upload_mode=1;$("div#btnNewDir").css("display","none");
$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("#btnPlayImage").css("display","none");$("div#btnCancelUpload").css("display","block");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},"slow");var a=addPathSlash(g_storage.get("openurl"));$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a);$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout()});$("#btnCancelUpload").click(closeUploadPanel);
$("div#hostview").scroll(function(){g_storage.set("hostviewscrollTop",$(this).scrollTop())});$("div#fileview").scroll(function(){g_storage.set("contentscrollLeft",$(this).scrollLeft());g_storage.set("contentscrollTop",$(this).scrollTop())});$("#menu_lan").change(function(){var a=$(this).val();g_storage.set("lan",a);window.location.reload()});$("#btnHelp").click(function(){var a=getPageSize(),d=$("div#modalWindow");g_modal_window_height=a[1]-30;g_modal_window_width=g_modal_window_height*1.28;g_modal_window_width>
a[0]&&(g_modal_window_width=a[0],g_modal_window_height=g_modal_window_width*0.78125);g_modal_url="/smb/css/help.html?showbutton=1";$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_help"));d&&d.jqmShow()});$("#btnConfig").click(function(){var a=g_storage.get("misc_http_enable"),d=g_storage.get("misc_http_port"),c=window.location.host;a==0&&!isPrivateIP()?alert(m.getString("msg_no_config")):(a=isPrivateIP()?"http://"+c.split(":")[0]:"http://"+c.split(":")[0]+":"+d,window.location=
a)});$("#btnPlayImage").click(function(){openImageViewer()});$(window).resize(adjustLayout)});
