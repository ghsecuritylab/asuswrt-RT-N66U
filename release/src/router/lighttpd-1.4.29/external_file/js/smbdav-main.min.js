var g_support_html5=0,g_reload_page=1,m=new lang,g_storage=new myStorage,g_listview=g_storage.get("listview")==void 0?0:g_storage.get("listview"),g_modal_url,g_modal_window_width=200,g_modal_window_height=80,timer_idle,g_show_modal=0,g_time_out=9E5,g_time_count=0,g_select_mode=0,g_select_array,g_upload_mode=0,g_folder_array,g_file_array,g_opening_uid="",g_on_button_animation=0,g_on_rescan_samba=0,g_rescan_samba_timer=0,g_rescan_samba_count=0,client=new davlib.DavClient;client.initialize();
g_support_html5=window.File&&window.FileReader&&window.FileList&&window.Blob?1:0;
function openImageViewer(b){for(var d=[],a=0;a<g_file_array.length;a++){var e=getFileExt(g_file_array[a].href);(e=="jpg"||e=="jpeg"||e=="png"||e=="gif")&&d.push(g_file_array[a])}if(d.length==0)alert(m.getString("msg_no_image_list"));else{for(a=e=0;a<d.length;a++)b==d[a].href&&(e=a);b="";a=getPageSize();b+='<div id="image_slide_show" class="barousel unselectable" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: '+a[0]/2+"px; top: "+a[1]/2+'px; z-index: 2999;">';b+=
'<div class="barousel_image">';for(a=0;a<d.length;a++){var c=window.location.protocol+"//"+window.location.host+d[a].href;b+=a==e?'<img src="" path="'+c+'" alt="" class="default"/>':'<img src="" path="'+c+'" alt="" class=""/>'}b+="</div>";b+='<div class="barousel_nav">';b+='<div class="barousel_content transparent" style="display: block; ">';for(a=0;a<d.length;a++)b+='<div class="',a==e&&(b+="default"),b+='" style="display: none; ">',b+='<p class="header">'+d[a].name+"</p>",b+="</div>";b+="</div>";
b+="</div>";b+="</div>";$(b).animate({width:"100%",height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({navType:2,manualCarousel:1,contentResize:0,startIndex:e})}}
function openAudioPlayer(b){for(var d=[],a=0;a<g_file_array.length;a++)getFileExt(g_file_array[a].href)=="mp3"&&d.push(g_file_array[a]);if(d.length==0)alert(m.getString("msg_no_image_list"));else{for(var e="",c=0,a=0;a<d.length;a++){var j=d[a].href;b==j&&(c=a);e+=j;a!=d.length-1&&(e+=",")}d=$("div#modalWindow");g_modal_url="/smb/css/audio.html?a="+b+"&alist="+e+"&index="+c;g_modal_window_width=450;g_modal_window_height=152;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_audioplayer"));
d&&d.jqmShow()}}
function openLoginWindow(b){var d=$("div#modalWindow"),a=d.css("display"),e=function(){var a=$("#table_login input#username").val(),d=$("#table_login input#password").val(),a="Basic "+Base64.encode(a+":"+d);closeJqmWindow(0);doLOGIN(b,a)};g_modal_url="";g_modal_window_width=360;g_modal_window_height=120;b=="/"?$("#jqmTitleText").text(m.getString("title_login")+" - AiCloud"):$("#jqmTitleText").text(m.getString("title_login")+" - "+b.substring(0,35));a=="block"&&$("#jqmMsgText").text(m.getString("msg_passerror"));$("#jqmMsg").css("display",
a);a="";a+='<table id="table_login" width="100%" height="100%" border="0" align="center" cellpadding="0" cellspacing="0" style="overflow:hidden;">';a+="<tr>";a+="<td>";a+='<form name="form_login">';a+="<fieldset>";a+="<table>";a+="<tr>";a+='<td><label id="username">'+m.getString("title_username")+'</label></td><td><input name="username" type="text" id="username" size="35" autocapitalize="off" width="250px"></td>';a+="</tr>";a+="<tr>";a+='<td><label id="password">'+m.getString("title_password")+'</label></td><td><input name="password" type="password" id="password" size="35" width="250px"></td>';
a+="</tr>";a+="</table>";a+="</fieldset>";a+="</form>";a+="</td>";a+="</tr>";a+='<tr style="height:10px"></tr>';a+="<tr>";a+="<td>";a+='<div class="table_block_footer" style="text-align:right">';a+='<button id="ok" class="btnStyle">'+m.getString("btn_ok")+"</button>";a+='<button id="cancel" class="btnStyle">'+m.getString("btn_cancel")+"</button>";a+="</div>";a+="</td>";a+="</tr>";a+="</table>";$("#jqmContent").empty();$(a).appendTo($("#jqmContent"));$("#table_login input#password").keydown(function(a){a.keyCode==
13&&e()});$("#table_login #ok").click(function(){e()});$("#table_login #cancel").click(function(){closeJqmWindow(0)});d&&d.jqmShow()}function doRescanSamba(){var b=addPathSlash(g_storage.get("openurl"));closeJqmWindow(0);showHideLoadStatus(!0);client.RESCANSMBPC(b,function(b){b[0]==2&&(g_storage.setl("onRescanSamba",1),g_storage.setl("onRescanSambaCount",0),g_storage.set("HostList",""),doPROPFIND("/"))})}
function doMKDIR(b){var d=addPathSlash(g_storage.get("openurl")),a=d+myencodeURI(b),e=0;$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&b==$(this).attr("title")&&(e=1,alert(m.getString("folder_already_exist_msg")))});e!=1&&client.MKCOL(a,function(a){a[0]==2?(doPROPFIND(d),closeJqmWindow(0)):alert(m.getString(a))})}
function doRENAME(b,d){var a=0,e=addPathSlash(g_storage.get("openurl")),c=e+d;$("a#list_item").each(function(){$(this).attr("isdir")=="1"&&d==$(this).attr("title")&&(a=1,alert(m.getString("folder_already_exist_msg")))});a!=1&&client.MOVE(b,c,function(a){a[0]==2?(doPROPFIND(e),closeJqmWindow(0)):alert(m.getString(a)+" : "+decodeURI(b))})}function getFileViewHeight(){return $("#fileview").height()}
function closeUploadPanel(b){g_upload_mode=0;g_reload_page=b;g_storage.set("stopLogoutTimer","0");$("div#btnNewDir").css("display","block");g_support_html5==1&&$("div#btnUpload").css("display","block");$("div#btnSelect").css("display","block");$("#btnPlayImage").css("display","block");$("div#btnCancelUpload").css("display","none");$("#function_help").text("");$("#upload_panel").animate({left:"1999px"},"slow",null,function(){$("#upload_panel").css("display","none");adjustLayout()});b==1&&(b=addPathSlash(g_storage.get("openurl")),
doPROPFIND(b))}
function cancelSelectMode(){g_select_mode!=0&&(g_select_mode=0,g_select_array=null,$("#btnDownload").addClass("disable"),$("#btnShareLink").addClass("disable"),$("#btnDeleteSel").addClass("disable"),$("#btnRename").addClass("disable"),$("div#btnNewDir").css("display","block"),g_support_html5==1&&$("div#btnUpload").css("display","block"),$("div#btnSelect").css("display","block"),$("#btnPlayImage").css("display","block"),$("div#btnCancelSelect").css("display","none"),$(".selectDiv").css("display","none"),
$(".selectHintDiv").css("display","none"),$("#fileview #fileviewicon").each(function(){$(this).removeClass("select")}),$("#function_help").text(""),adjustLayout(),$("#button_panel").animate({left:"1999px"},"slow",null,function(){}))}
function adjustLayout(){var b=getPageSize(),d=b[0],a=b[1]-$("#header_region").height()-$("#bottom_region").height();$("#main_region").css("height",a);b=b[0];$("#main_region #main_right_region").css("width",b-$("#main_region #main_left_region").width());b=$("#main_left_region").height()-$("#infobar").height()-$("#settingbar").height();a=Math.max(Math.floor(b/40),1)*40;$("#hostview").css("height",a);$("#settingbar").css("padding-top",b-a);var e=0;$("#toolbar .albutton").each(function(){$(this).css("display")==
"block"&&(e+=$(this).width())});$("#urlregion-url").css("width",$("#toolbar").width()-e-20);createOpenUrlUI(g_storage.get("openurl"));b=g_select_mode==1?$("#main_right_container").height()-$("#infobar").height()-$("#button_panel").height():$("#main_right_container").height()-$("#infobar").height();$("#fileview").css("height",b);$("#function_help").css("left",$("#main_left_region").width());(b=$("div#modalWindow"))&&b.css("left",(d-g_modal_window_width)/2)}
function closeJqmWindow(b){g_reload_page=b;b=$("div#modalWindow");$("iframe",b).attr("src","");b&&b.jqmHide();showHideLoadStatus(!1)}function resizeJqmWindow(b,d){var a=$(".jqmWindow");a&&(a.css("width",b+"px"),a.css("height",d+"px"))}function fullscreenJqmWindow(){var b=$("div#modalWindow");b&&(b.css("left","0px"),b.css("top","0px"),b.css("width",window.width+"px"),b.css("height",window.height+"px"))}
function doLOGOUT(){doPROPFIND("/",function(){addPathSlash(g_storage.get("openurl"));client.LOGOUT("/",function(b){b[0]==2&&(g_storage.set("openhostuid","0"),window.location.reload())})},0)}function resetTimer(){clearInterval(timer_idle);g_time_count=0;timer_idle=setInterval(function(){g_storage.get("stopLogoutTimer")=="1"||g_show_modal==1?g_time_count=0:(g_time_count++,g_time_count*1E3>g_time_out&&(g_time_count=0,doLOGOUT()))},1E3)}
function createOpenUrlUI(b){b==void 0&&(b="/");var d=mydecodeURI(b),a="",e="",c="",j=$("#urlregion-url").width();if(d!="/")for(var d=d.split("/"),b=b.split("/"),g=0;g<d.length;g++)if(d[g]!=""){e+="/"+b[g];c+=" / <a id='url_path' uhref='"+e+"'>"+d[g]+"</a>";if(String(c).width($("p#openurl").css("font"))>j){a+=" / ...";break}a+=" / <a id='url_path' uhref='"+e+"'>"+d[g]+"</a>";c=a}$("p#openurl").empty();$("p#openurl").append(a);$("a#url_path").click(function(){doPROPFIND($(this).attr("uhref"))})}
function doPROPFIND(b,d,a){if(client!=null){showHideLoadStatus(!0);try{client.PROPFIND(b,a,function(a,e,g){if(a){if(a==207){cancelSelectMode();closeUploadPanel();g_folder_array=[];g_file_array=[];if(window.DOMParser)a=new DOMParser,a=a.parseFromString(g,"text/xml");else if(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(g),!a.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var f,k,i,l,t,e=a.documentElement.childNodes,g=a.documentElement.getAttribute("qtype");
a.documentElement.getAttribute("readonly");a.documentElement.getAttribute("ruser");a.documentElement.getAttribute("computername");a=a.documentElement.getAttribute("isusb");for(f=0;f<e.length;f++){var o="",u="",x="",q="",v="",y="",z="",A="",B="",C="",r="",s="",w="",h,p=e[f].childNodes;for(k=0;k<p.length;k++)if(p[k].nodeType==1&&p[k].nodeName=="D:propstat"){var E=p[k].childNodes;for(i=0;i<E.length;i++)if(E[i].nodeName=="D:prop"){var n=E[i].childNodes;for(l=0;l<n.length;l++)if(!(n[l].childNodes.length<=
0))if(n[l].nodeName=="D:getcontenttype")u=String(n[l].childNodes[0].nodeValue);else if(n[l].nodeName=="D:getuniqueid")x=String(n[l].childNodes[0].nodeValue);else if(n[l].nodeName=="D:getonline")y=String(n[l].childNodes[0].nodeValue);else if(n[l].nodeName=="D:getlastmodified")z=String(n[l].childNodes[0].nodeValue);else if(n[l].nodeName=="D:getcontentlength")A=String(size_format(parseInt(n[l].childNodes[0].nodeValue)));else if(n[l].nodeName=="D:getmac")C=String(n[l].childNodes[0].nodeValue);else if(n[l].nodeName==
"D:getip")B=String(n[l].childNodes[0].nodeValue);else if(n[l].nodeName=="D:gettype")r=String(n[l].childNodes[0].nodeValue);else if(n[l].nodeName=="D:getattr"){var D=n[l].childNodes;for(t=0;t<D.length;t++)if(D[t].nodeName=="D:readonly")s=D[t].childNodes[0].nodeValue;else if(D[t].nodeName=="D:hidden")w=D[t].childNodes[0].nodeValue}}}else p[k].nodeType==1&&p[k].nodeName=="D:href"&&(o=String(p[k].childNodes[0].nodeValue),i="",o.match(/^http/)&&(i=window.location.protocol+"//"+window.location.host),l=
i+addPathSlash(b),o!=l?(q=b,o=o.replace(i,""),q=o.replace(addPathSlash(q),""),q!=""?(h=q,v=q=mydecodeURI(q),i=g_listview==0?12:45,v.length>i&&(v=v.substring(0,i)+"...")):o=""):o="");o!=""&&(u=="httpd/unix-directory"?g_folder_array.push({contenttype:u,href:o,name:q,uname:h,shortname:v,online:y,time:z,size:A,ip:B,mac:C,uid:x,type:r,freadonly:s,fhidden:w}):g_file_array.push({contenttype:u,href:o,name:q,uname:h,shortname:v,online:y,time:z,size:A,ip:B,mac:C,uid:x,type:r,freadonly:s,fhidden:w}))}g_folder_array.sort(sortByName);
g_file_array.sort(sortByName);for(h=0;h<g_folder_array.length;h++)if(g_folder_array[h].type=="usbdisk"){arraymove(g_folder_array,h,0);break}h=addPathSlash(b);h!="/"&&(h=h.substring(0,h.length-1),h=h.substring(0,h.lastIndexOf("/")),h==""&&(h="/"));createHostList(g,g_folder_array);createThumbView(g,h,g_folder_array,g_file_array);g==0&&g_select_mode==0?($("#btnUpload").css("display","block"),$("#btnSelect").css("display","block"),$("#btnNewDir").css("display","block"),$("#btnPlayImage").css("display",
"block")):($("#btnUpload").css("display","none"),$("#btnSelect").css("display","none"),$("#btnNewDir").css("display","none"),$("#btnPlayImage").css("display","none"));g_support_html5==0&&$("#btnUpload").css("display","none");g_select_mode==1&&$("#btnCancelSelect").css("display","block");g_upload_mode==1&&$("#btnCancelUpload").css("display","block");g==1&&a==0?$("#btnChangeUser").css("display","block"):$("#btnChangeUser").css("display","none");g_storage.set("openurl",b);$("div#hostview").scrollTop(g_storage.get("hostviewscrollTop"));
$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));adjustLayout();closeJqmWindow(0);d!=void 0&&d()}else a==501?doPROPFIND(b):a==401?setTimeout(openLoginWindow(b),1E3):alert(m.getString(a));showHideLoadStatus(!1)}},null,1),resetTimer()}catch(e){alert("catch error: "+e)}}}
function doLOGIN(b,d){doPROPFIND(b,function(){g_storage.set("openhostuid",g_opening_uid);$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).css("background-color","#009583"):$(this).css("background-color","#014051")});g_opening_uid=""},d)}
function refreshHostList(){if(client!=null)try{client.PROPFIND("/",null,function(b,a,e){if(b&&b==207){var c,b=[];if(window.DOMParser)a=new DOMParser,c=a.parseFromString(e,"text/xml");else if(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(e),!c.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var j,g,f,k,a=c.documentElement.childNodes,e=c.documentElement.getAttribute("qtype");c.documentElement.getAttribute("readonly");c.documentElement.getAttribute("ruser");
c.documentElement.getAttribute("computername");c.documentElement.getAttribute("isusb");for(c=0;c<a.length;c++){var i="",l="",t="",o="",u="",x="",q="",v="",y="",z="",A="",B="",C="",r,s=a[c].childNodes;for(j=0;j<s.length;j++)if(s[j].nodeType==1&&s[j].nodeName=="D:propstat"){var w=s[j].childNodes;for(g=0;g<w.length;g++)if(w[g].nodeName=="D:prop"){var h=w[g].childNodes;for(f=0;f<h.length;f++)if(!(h[f].childNodes.length<=0))if(h[f].nodeName=="D:getcontenttype")l=String(h[f].childNodes[0].nodeValue);else if(h[f].nodeName==
"D:getuniqueid")t=String(h[f].childNodes[0].nodeValue);else if(h[f].nodeName=="D:getonline")x=String(h[f].childNodes[0].nodeValue);else if(h[f].nodeName=="D:getlastmodified")q=String(h[f].childNodes[0].nodeValue);else if(h[f].nodeName=="D:getcontentlength")v=String(size_format(parseInt(h[f].childNodes[0].nodeValue)));else if(h[f].nodeName=="D:getmac")z=String(h[f].childNodes[0].nodeValue);else if(h[f].nodeName=="D:getip")y=String(h[f].childNodes[0].nodeValue);else if(h[f].nodeName=="D:gettype")A=
String(h[f].childNodes[0].nodeValue);else if(h[f].nodeName=="D:getattr"){var p=h[f].childNodes;for(k=0;k<p.length;k++)if(p[k].nodeName=="D:readonly")B=p[k].childNodes[0].nodeValue;else if(p[k].nodeName=="D:hidden")C=p[k].childNodes[0].nodeValue}}}else s[j].nodeType==1&&s[j].nodeName=="D:href"&&(i=String(s[j].childNodes[0].nodeValue),g="",i.match(/^http/)&&(g=window.location.protocol+"//"+window.location.host),f=g+addPathSlash("/"),i!=f?(i=i.replace(g,""),o=i.replace(addPathSlash("/"),""),o!=""?(r=
o,u=o=mydecodeURI(o),g=g_listview==0?12:45,u.length>g&&(u=u.substring(0,g)+"...")):i=""):i="");i!=""&&l=="httpd/unix-directory"&&b.push({contenttype:l,href:i,name:o,uname:r,shortname:u,online:x,time:q,size:v,ip:y,mac:z,uid:t,type:A,freadonly:B,fhidden:C})}b.sort(sortByName);for(r=0;r<b.length;r++)if(b[r].type=="usbdisk"){arraymove(b,r,0);break}createHostList(e,b)}},null,1)}catch(b){alert("catch error: "+b)}}
function createHostList(b,d){var a="";$("#hostview").empty();var e=g_storage.get("HostList")?g_storage.get("HostList").split(/,/):[],c=g_storage.getl("onRescanSamba"),j=g_storage.getl("onRescanSambaCount");if(b==2)for(var g=0;g<d.length;g++){var f=d[g].href+"|"+d[g].name+"|"+d[g].online+"|"+d[g].ip+"|"+d[g].mac+"|"+d[g].uid+"|"+d[g].freadonly+"|"+d[g].fhidden+"|"+d[g].type;e.contains(f)||e.push(f);g_storage.set("HostList",e.join(","))}for(g=0;g<e.length;g++)f=e[g].split("|"),a+="<div class='host_item unselectable",
f[2]==0&&(a+=" offline"),a+="' uhref='",a+=f[0],a+="' title='",a+=f[1]+" - "+f[3],a+="' online='",a+=f[2],a+="' isdir='1'",a+=" ip='",a+=f[3],a+="' mac='",a+=f[4],a+="' uid='",a+=f[5],a+="' freadonly='",a+=f[6],a+="' fhidden='",a+=f[7],a+=f[8]=="usbdisk"?"' isusb='1'":"' isusb='0'",a+=">",a+="<div id='hosticon' class='sicon "+f[8],f[2]==0&&(a+="off"),a+="'/>",a+="<div id='hostname' class='unselectable'>",a+="<p>",a+=f[1],f[2]==0&&(a+="("+m.getString("title_offline")+")"),a+="</p>",a+="</div>",a+=
"</div>";c==1&&(a+="<div class='scan_item unselectable rescan'>",a+="<div id='hosticon' class='sicon sambapcrescan'/>",a+="<div id='scanlabel' class='unselectable'>",a+="<p>"+m.getString("title_scan"),a+="</p>",a+="</div>",a+="</div>",g_rescan_samba_timer==0&&(g_rescan_samba_timer=setInterval(function(){j++;j>=10?(clearInterval(g_rescan_samba_timer),g_storage.setl("onRescanSamba",0),g_storage.setl("onRescanSambaCount",0)):g_storage.setl("onRescanSambaCount",j);refreshHostList()},5E3)));$("#hostview").append(a);
var k=g_storage.get("openhostuid");$("#hostview .host_item").each(function(){$(this).attr("uid")==k?$(this).css("background-color","#009583"):$(this).css("background-color","#014051")});$("#hostview .host_item").click(function(){if($(this).attr("online")==0)confirm(m.getString("wol_msg"))==!0&&client.WOL("/",$(this).attr("mac"),function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))});else{g_opening_uid=$(this).attr("uid");var a=$(this).attr("uhref");g_storage.set("opentype",
$(this).attr("type")=="usbdisk"?"1":"0");doPROPFIND(a,function(){g_storage.set("openhostuid",g_opening_uid);$("#hostview .host_item").each(function(){$(this).attr("uid")==g_opening_uid?$(this).css("background-color","#009583"):$(this).css("background-color","#014051")});g_opening_uid=""},null)}})}
function createThumbView(b,d,a,e){var c="";$("#main_right_container #fileview").empty();if(b!=2){b==0&&(c+='<div class="albumDiv">',c+='<table class="thumb-table-parent">',c+="<tbody>",c+="<tr><td>",c+='<div class="picDiv" isParent="1" popupmenu="0" uhref="',c+=d,c+='">',c+='<div class="parentDiv bicon"></div></div>',c+="</td></tr>",c+="<tr><td>",c+='<div class="albuminfo">',c+='<a id="list_item" qtype="1" isdir="1" uhref="',c+=d,c+='" title="'+m.getString("btn_prevpage")+'" online="0">'+m.getString("btn_prevpage"),
c+="</a>",c+="</div>",c+="</td></tr>",c+="</tbody>",c+="</table>",c+="</div>");for(d=0;d<a.length;d++){var j=m.getString("table_filename")+": "+a[d].name+"\n"+m.getString("table_time")+": "+a[d].time;c+='<div class="albumDiv" ';c+=' title="';c+=j;c+='">';c+='<table class="thumb-table-parent">';c+="<tbody>";c+="<tr><td>";c+='<div class="picDiv" popupmenu="';c+=b=="0"?"1":"0";c+='" uhref="';c+=a[d].href;c+='">';c+=b=="2"?a[d].type=="usbdisk"?'<div id="fileviewicon" class="usbDiv bicon">':a[d].online==
"1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':'<div id="fileviewicon" class="folderDiv bicon">';c+='<div class="selectDiv sicon"></div>';c+='<div class="selectHintDiv sicon"></div>';c+="</div></div>";c+="</td></tr>";c+="<tr><td>";c+='<div class="albuminfo">';c+='<a id="list_item" qtype="';c+=b;c+='" isdir="1" uhref="';c+=a[d].href;c+='" title="';c+=a[d].name;c+='" online="';c+=a[d].online;c+='" ip="" mac="';c+=a[d].mac;c+='" uid="';
c+=a[d].uid;c+='" freadonly="';c+=a[d].freadonly;c+='" fhidden="';c+=a[d].fhidden;c+=a[d].type=="usbdisk"?'" isusb="1"':'" isusb="0"';c+='">';c+=a[d].shortname;a[d].online=="0"&&b=="2"&&(c+="("+m.getString("title_offline")+")");c+="</a>";c+="</div>";c+="</td></tr>";c+="</tbody>";c+="</table>";c+="</div>"}for(d=0;d<e.length;d++)j=m.getString("table_filename")+": "+e[d].name+"\n"+m.getString("table_time")+": "+e[d].time+"\n"+m.getString("table_size")+": "+e[d].size,c+='<div class="albumDiv"',c+=' title="',
c+=j,c+='">',c+='<table class="thumb-table-parent">',c+="<tbody>",a=getFileExt(String(e[d].href)),a.length>5&&(a=""),c+="<tr><td>",c+=b=="0"?'<div class="picDiv" popupmenu="1" uhref="':'<div class="picDiv" popupmenu="0" uhref="',c+=e[d].href,c+='">',c+=a=="jpg"||a=="jpeg"||a=="png"||a=="gif"||a=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':a=="mp3"||a=="m4a"||a=="m4r"||a=="wav"?'<div id="fileviewicon" class="audiofileDiv bicon">':a=="mp4"||a=="rmvb"||a=="m4v"||a=="wmv"||a=="avi"||a=="mpg"||
a=="mpeg"||a=="mkv"||a=="mov"||a=="flv"||a=="3gp"||a=="m2v"||a=="rm"?'<div id="fileviewicon" class="videofileDiv bicon">':a=="doc"||a=="docx"?'<div id="fileviewicon" class="docfileDiv bicon">':a=="ppt"||a=="pptx"?'<div id="fileviewicon" class="pptfileDiv bicon">':a=="xls"||a=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv bicon">':a=="pdf"?'<div id="fileviewicon" class="pdffileDiv bicon">':'<div id="fileviewicon" class="fileDiv bicon">',c+='<div class="selectDiv sicon"></div>',c+='<div class="selectHintDiv sicon"></div>',
c+="</div></div>",c+="</td></tr>",c+="<tr><td>",c+='<div class="albuminfo" style="font-size:80%">',c+='<a id="list_item" qtype="1" isdir="0" uhref="',c+=e[d].href,c+='" title="',c+=e[d].name,c+='" uid="',c+=e[d].uid,c+='" ext="',c+=a,c+='" freadonly="',c+=e[d].freadonly,c+='" fhidden="',c+=e[d].fhidden,c+='">',c+=e[d].shortname,c+="</a>",c+="</div>",c+="</td></tr>",c+="</tbody>",c+="</table>",c+="</div>";$("#main_right_container #fileview").append(c);$(".picDiv").mousedown(onMouseDownPicDIVHandler)}}
function sortByName(b,d){var a=b.name.toLowerCase(),e=d.name.toLowerCase();return a<e?-1:a>e?1:0}function arraymove(b,d,a){var e=b[d];b.splice(d,1);b.splice(a,0,e)}function getPageSize(){var b=$(window).width(),d=$(window).height();return[b,d]}function showHideLoadStatus(b){b?$("#loading").css("display","block"):$("#loading").css("display","none")}
function onMouseDownPicDIVHandler(b){if(b.button==2||g_on_button_animation==1)return!1;if(g_select_mode==1)if($(this).attr("isParent")==1)cancelSelectMode(),openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"));else{$(this).find(".selectDiv").css("display")=="none"?($(this).find(".selectDiv").css("display","block"),$(this).find(".selectHintDiv").css("display","none")):($(this).find(".selectDiv").css("display","none"),$(this).find(".selectHintDiv").css("display","block"));g_select_array=
null;g_select_array=[];var d=0,a=0;$("#fileview").find(".albumDiv").each(function(){if($(this).find(".selectDiv").css("display")=="block"){var b=$(this).find("#list_item").attr("uhref"),c=$(this).find("#list_item").attr("isdir"),j=myencodeURI($(this).find("#list_item").attr("title"));c==1?a++:d++;g_select_array.push({isdir:c,uhref:b,title:j})}});d>=1?$("#btnDownload").removeClass("disable"):$("#btnDownload").addClass("disable");d>0?$("#btnShareLink").removeClass("disable"):$("#btnShareLink").addClass("disable");
d>0||a>0?$("#btnDeleteSel").removeClass("disable"):$("#btnDeleteSel").addClass("disable");d+a==1?$("#btnRename").removeClass("disable"):$("#btnRename").addClass("disable")}else openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}
function openSelItem(b){var d=b.attr("uhref"),a=b.attr("qtype"),e=b.attr("isdir"),c=b.attr("isusb"),j=b.attr("uhref"),g=b.attr("title");g_storage.set("openuid",b.attr("uid"));g_storage.set("opentype",c);if(a==2&&b.attr("online")==0)confirm(m.getString("wol_msg"))==!0&&(d=b.attr("mac"),client.WOL("/",d,function(a){a==200?alert(m.getString("wol_ok_msg")):alert(m.getString("wol_fail_msg"))}));else if(e=="1")doPROPFIND(d,null,null);else{b=getFileExt(d);a=g_storage.get("webdav_mode");if(b=="mp4"||b=="m4v"||
b=="wmv"||b=="avi"||b=="rmvb"||b=="rm"||b=="mpg"||b=="mpeg"||b=="mkv"||b=="mov"||b=="flv")if((a==0||a==2)&&isWinOS())if(isBrowser("msie")&&getInternetExplorerVersion()<=7)alert(m.getString("msg_vlcsupport"));else{var f=$("div#modalWindow"),g=myencodeURI(g);this_url=j.substring(0,j.lastIndexOf("/"));var k=window.location.host;k.indexOf(":")!=-1&&(k=k.substring(0,k.indexOf(":")));k="http://"+k+":"+g_storage.get("http_port")+"/";client.GSL(this_url,this_url,g,0,0,function(a,b,c){a==200&&(a=parseXml(c),
a=$(a).find("sharelink").text(),b="",a=k+a,b="/smb/css/vlc_video.html?v="+a,b+="&showbutton=1",g_modal_url=b,g_modal_window_width=655,g_modal_window_height=480,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_videoplayer")),f&&f.jqmShow())});return}if(b=="mp3")openAudioPlayer(d);else{if(b=="doc"||b=="docx"||b=="ppt"||b=="pptx"||b=="xls"||b=="xlsx"||b=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){g=myencodeURI(g);this_url=j.substring(0,j.lastIndexOf("/"));client.GSL(this_url,
this_url,g,0,0,function(a,b,c){a==200&&(a=parseXml(c),a=$(a).find("sharelink").text(),b="",a=window.location.protocol+"//"+window.location.host+"/"+a,window.open("https://docs.google.com/viewer?url="+a))});return}b=="jpg"||b=="jpeg"||b=="png"||b=="gif"?openImageViewer(d):window.open(d)}}}
function createLayout(){var b=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),d=g_storage.get("lan")==void 0?b:g_storage.get("lan");m.setLanguage(d);b="";b+="<div id='header_region' class='unselectable' width='100%' border='0'>";b+="<div id='logo'></div>";b+="<div id='user'>Welcome home, <span id='username'>admin</span><span id='login_info'></span>";b+="</div>";b+="<div id='loading'><img src='/smb/css/load.gif'/><div><span>Loading...</span></div></div>";b+="<div class='albutton toolbar-button-right' id='btnHelp'><div class='ticon'></div></div>";
b+="</div>";b+="<div id='main_region' class='unselectable'>";b+="<div id='main_left_region' class='unselectable'>";b+="<div id='infobar' class='unselectable'></div>";b+="<div id='hostview' class='unselectable'></div>";b+="<div id='settingbar' class='unselectable'>";b+="<div id='buttonpanel' class='unselectable'>";b+="<div class='toolbar-button-left' style='width:40px;height:40px;background-color:#FFC000'></div>";b+="<div class='albutton toolbar-button-left' id='btnLogout' style='background-color:#0F4373'><div class='ticon'></div></div>";
b+="<div class='albutton toolbar-button-left' id='btnConfig' style='background-color:#578EA2'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-left' id='btnFavorite' style='background-color:#008F6D'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-left' id='btnSetting' style='background-color:#6A6A6A'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-left' id='btnRefresh' style='background-color:#346948'><div class='ticon'></div></div>";
b+="</div>";b+="</div>";b+="</div>";b+="<div id='main_right_region' class='unselectable'>";b+="<div id='main_right_container' class='unselectable'>";b+="<div id='infobar' class='unselectable'>";b+="<div id='toolbar' class='unselectable'>";b+="<div id='urlregion-url'>";b+="<p id='openurl' align='left' width='150' style='padding-left:10px' ></p>";b+="</div>";b+="<div class='albutton toolbar-button-right' id='btnUpload' style='display:none'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-right' id='btnPlayImage' style='display:none'><div class='ticon'></div></div>";
b+="<div class='albutton toolbar-button-right' id='btnNewDir' style='display:none'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-right' id='btnSelect' style='display:none'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-right' id='btnCancelSelect' style='display:none'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-right' id='btnCancelUpload' style='display:none'><div class='ticon'></div></div>";b+="<div class='albutton toolbar-button-right' id='btnChangeUser' style='display:none'><div class='ticon'></div></div>";
b+="</div>";b+="</div>";b+="<div id='fileview' class='unselectable'></div>";b+="<div id='button_panel' class='unselectable'>";b+="<div class='abbutton toolbar-button-right disable' id='btnShareLink' style='display:block'><div class='ticon'></div></div>";b+="<div class='abbutton toolbar-button-right disable' id='btnDeleteSel' style='display:block'><div class='ticon'></div></div>";b+="<div class='abbutton toolbar-button-right disable' id='btnDownload' style='display:block'><div class='ticon'></div></div>";
b+="<div class='abbutton toolbar-button-right disable' id='btnRename' style='display:block'><div class='ticon'></div></div>";b+="</div>";b+="<div id='upload_panel' class='unselectable'>";b+="<div style='position:absolute;width:98%;height:100%;padding:10px'>";b+="<iframe src='' width='100%' height='100%' frameborder='0'/>";b+="</div>";b+="</div>";b+="</div>";b+="</div>";b+="</div>";b+="<div id='bottom_region' class='unselectable'>";b+="<span id='function_help'></span>";b+="<div class='lan'>";b+="<span>"+
m.getString("title_language")+"</span>";b+="<select id='menu_lan'>";b+="<option value='en-us' selected>"+m.getString("lan_en")+"</option>";b+="<option value='zh-tw'>"+m.getString("lan_zh-tw")+"</option>";b+="</select>";b+="</div>";b+="</div>";b+="<div id='modalWindow' class='jqmWindow'>";b+="<div id='jqmTitle'>";b+="<span id='jqmTitleText'></span>";b+="</div>";b+="<div id='jqmMsg'>";b+="<span id='jqmMsgText'></span>";b+="</div>";b+="<div id='jqmContent' style='padding;0px;margin:0px'>";b+="</div>";
b+="</div>";$("body").empty();$("body").append(b);$("#menu_lan").children().each(function(){$(this).val()==d&&$(this).attr("selected","true")});$("span#username").click(function(){confirm(m.getString("msg_logout_confirm"))==!0&&doLOGOUT()});$("#btnHelp").attr("title",m.getString("title_help"));$("#btnLogout").attr("title",m.getString("title_logout"));$("#btnConfig").attr("title",m.getString("btn_config"));$("#btnUpload").attr("title",m.getString("btn_upload"));$("#btnCancelUpload").attr("title",m.getString("btn_cancelupload"));
$("#btnSelect").attr("title",m.getString("btn_select"));$("#btnCancelSelect").attr("title",m.getString("btn_cancelselect"));$("#btnNewDir").attr("title",m.getString("btn_newdir"));$("#btnShareLink").attr("title",m.getString("btn_sharelink"));$("#btnDeleteSel").attr("title",m.getString("btn_delselect"));$("#btnDownload").attr("title",m.getString("func_download"));$("#btnRename").attr("title",m.getString("btn_rename"));$("#btnSetting").attr("title",m.getString("title_setting"));$("#btnRefresh").attr("title",
m.getString("btn_refresh"))}
$(document).ready(function(){function b(a){a&&a[0]!=2?alert(m.getString(a)+" : "+decodeURI(g_selected_files[0])):(g_selected_files.splice(0,1),g_selected_files.length<=0?(a=addPathSlash(g_storage.get("openurl")),doPROPFIND(a)):client.DELETE(g_selected_files[0],b))}document.oncontextmenu=function(){return!1};document.onmousedown=function(){resetTimer()};document.onmousemove=function(){resetTimer()};$(document).keydown(function(a){a.keyCode==27&&(g_select_mode==1?cancelSelectMode():g_upload_mode==1&&
closeUploadPanel(),closeJqmWindow())});g_storage.set("stopLogoutTimer","0");g_storage.set("isOpenModalWindow","0");createLayout();showHideLoadStatus(!1);adjustLayout();(function(){client.GETROUTERINFO("/",function(a,b,c){a==200&&(a=parseXml(c),a=$(a),g_storage.set("webdav_mode",a.find("webdav_mode").text()),g_storage.set("http_port",a.find("http_port").text()),g_storage.set("https_port",a.find("https_port").text()),g_storage.set("misc_http_enable",a.find("misc_http_enable").text()),g_storage.set("misc_http_port",
String(a.find("misc_http_port").text()).replace("\n","")),g_storage.set("last_login_info",a.find("last_login_info").text()),g_storage.set("ddns_host_name",a.find("ddns_host_name").text()),g_storage.set("router_version",a.find("version").text()),a=g_storage.get("last_login_info"),a!=""&&a!=void 0&&(a=String(a).split(">"),a=m.getString("title_logininfo")+a[1]+", "+m.getString("title_ip")+a[2],$("#login_info").text(a)))})})();var d=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",
function(){d!=void 0&&d!="/"&&doPROPFIND(d);if(g_storage.get("openhostuid")==void 0||g_storage.get("openhostuid")==0){var a="<div id='help_1'>";a+="<div id='help_content'>";a+=m.getString("msg_help");a+="</div>";a+="<div id='help_image'>";a+="</div>";a+="</div>";$("div#fileview").append(a)}},0);$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(a){$(a.w).fadeOut("2000",function(){a.o.remove();g_show_modal=0;if(g_reload_page==1){var b=addPathSlash(g_storage.get("openurl"));
doPROPFIND(b)}})},onShow:function(a){var a=$(a.w),b=$("#jqmContent",a);$("#jqmTitle",a);var c=(getPageSize()[0]-g_modal_window_width)/2;g_show_modal=1;navigator.userAgent.toLowerCase().indexOf("msie");var d=function(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));return a};g_modal_url!=""&&(b.empty(),$("<iframe src='' frameborder='0' width='100%' height='100%'>").appendTo(b),$("iframe",a).attr("src",
g_modal_url));isBrowser("msie")&&d()<=8&&(g_modal_window_height+=25);a.css({width:g_modal_window_width,height:g_modal_window_height,left:c,top:-g_modal_window_height,opacity:0}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:c,marginLeft:0,opacity:1},200,function(){adjustLayout()})}});$("div#btnDeleteSel").click(function(){if(!(g_select_array.length<=0)&&confirm(m.getString("del_files_msg"))==!0){g_selected_files=null;g_selected_files=[];for(var a=0;a<g_select_array.length;a++)g_selected_files.push(g_select_array[a].uhref);
client.DELETE(g_selected_files[0],b)}});$("div#btnNewDir").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/makedir.html";g_modal_window_width=500;g_modal_window_height=80;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_newdir"));a&&a.jqmShow()});$("div#btnRefresh").click(function(){var a=g_storage.get("openurl");g_storage.set("HostList","");doPROPFIND("/",function(){a=a==void 0?"/":a;a!="/"&&doPROPFIND(a)},0)});$("div#btnLogout").click(function(){confirm(m.getString("msg_logout_confirm"))==
!0&&doLOGOUT()});$("div#btnSetting").click(function(){var a=$("div#modalWindow");g_modal_url="/smb/css/setting.html";g_modal_window_width=800;g_modal_window_height=600;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_setting"));a&&a.jqmShow()});$("div#btnFavorite").click(function(){var a="https://"+g_storage.get("ddns_host_name"),b=isBrowser("msie");if(a==""||a==void 0)a="https://www.asusnetwork.net/";if(typeof window.sidebar=="object"&&typeof window.sidebar.addPanel==
"function")return window.sidebar.addPanel("AiCloud",a,""),!1;else if(b&&typeof window.external=="object")return window.external.AddFavorite(a,"AiCloud"),!1;else{window.location=a;var a=navigator.userAgent.toLowerCase(),b="",c=a.indexOf("webkit")!=-1,d=a.indexOf("mac")!=-1;if(a.indexOf("konqueror")!=-1)b="CTRL + B";else if(window.home||c||d)b=(d?"Command/Cmd":"CTRL")+" + D";b=b?m.getString("msg_add_favorite1")+b+m.getString("msg_add_favorite2"):b;alert(b)}});$("div#btnShareLink").click(function(){if(!(g_select_array.length<=
0)){m.getString("email_subject");for(var a="",b="",c="",d=0;d<g_select_array.length;d++){var g=g_select_array[d].title,f=g_select_array[d].uhref,k=window.location.href;g_select_array[d].isdir!=1&&(b=k=f.substring(0,f.lastIndexOf("/")),c+=g,c+=";")}var d=g_storage.get("webdav_mode"),i=window.location.host;i.indexOf(":")!=-1&&(i=i.substring(0,i.indexOf(":")));i=d==0?"http://"+i+":"+g_storage.get("http_port"):"https://"+i;client.GSL(b,b,c,86400,1,function(b,c,d){if(b==200)if(b=parseXml(d),b=$(b).find("sharelink").text(),
b=="")alert("Fail to parse xml!");else{b=b.split(";");c=b.length;for(d=0;d<c;d++)a+=i+"/"+b[d],d!=c-1&&(a+="<br><br>");b=$("div#modalWindow");g_modal_url="/smb/css/sharelink.html?v="+a;g_modal_window_width=600;g_modal_window_height=500;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_sharelink"));b&&b.jqmShow()}})}});$("div#btnDownload").click(function(){if(!(g_select_array.length<=0))for(var a=0;a<g_select_array.length;a++){var b=g_select_array[a].title,c=g_select_array[a].uhref,
d=window.location.href;g_select_array[a].isdir!=1&&(d=c.substring(0,c.lastIndexOf("/")),$.fileDownload(d+"/"+b,{successCallback:function(){},failCallback:function(a,b){window.open(b)}}))}});$("div#btnRename").click(function(){if(g_select_array.length==1){var a=g_select_array[0].title,b=g_select_array[0].uhref,c=g_select_array[0].isdir,d=$("div#modalWindow");g_modal_url="/smb/css/rename.html?o="+a+"&f="+b+"&d="+c;g_modal_window_width=500;g_modal_window_height=80;$("#jqmMsg").css("display","none");
$("#jqmTitleText").text(m.getString("title_rename"));d&&d.jqmShow()}});$("div#btnChangeUser").click(function(){$("#main_right_container #fileview").empty();var a=g_storage.get("openurl");client.LOGOUT(a,function(b){b==200&&doPROPFIND(a)})});$("div#btnSelect").click(function(){g_select_mode=1;$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("#btnPlayImage").css("display","none");var a=$("div#btnNewDir").width()+$("div#btnUpload").width()+
5;$("div#btnCancelSelect").css("display","block");$("div#btnCancelSelect").css("right",a);g_on_button_animation=1;$("div#btnCancelSelect").animate({right:5},500,function(){$(".selectHintDiv").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))});
g_on_button_animation=0})});$("div#btnSelect2").click(function(){g_select_mode=1;$(".selectHintDiv").css("display","block");$("div#btnNewDir").css("display","none");$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("div#btnCancelSelect").css("display","block");$("#fileview #fileviewicon").each(function(){$(this).addClass("select")});adjustLayout();$("#button_panel").css("left","1999px");$("#button_panel").css("display","block");$("#button_panel").animate({left:"0px"},
"slow",null,function(){$("#function_help").text(m.getString("msg_selectmode_help"))})});$("div#btnCancelSelect").click(function(){$("div#btnCancelSelect").css("display","none");$("div#btnSelect").css("display","block");$("div#btnSelect").css("right",5);g_on_button_animation=1;$("div#btnSelect").animate({right:85},500,function(){cancelSelectMode();$("div#btnSelect").css("right",5);g_on_button_animation=0})});$("#btnUpload").click(function(){g_upload_mode=1;$("div#btnNewDir").css("display","none");
$("div#btnUpload").css("display","none");$("div#btnSelect").css("display","none");$("#btnPlayImage").css("display","none");$("div#btnCancelUpload").css("display","block");$("#upload_panel").css("display","block");$("#upload_panel").css("left","1999px");$("#upload_panel").animate({left:"0px"},"slow");var a=addPathSlash(g_storage.get("openurl"));$("#upload_panel iframe").attr("src","/smb/css/upload.html?u="+a);$("#function_help").text(m.getString("msg_uploadmode_help"));adjustLayout()});$("#btnCancelUpload").click(closeUploadPanel);
$("div#hostview").scroll(function(){g_storage.set("hostviewscrollTop",$(this).scrollTop())});$("div#fileview").scroll(function(){g_storage.set("contentscrollLeft",$(this).scrollLeft());g_storage.set("contentscrollTop",$(this).scrollTop())});$("#menu_lan").change(function(){var a=$(this).val();g_storage.set("lan",a);window.location.reload()});$("#btnHelp").click(function(){var a=getPageSize(),b=$("div#modalWindow");g_modal_window_height=a[1]-30;g_modal_window_width=g_modal_window_height*1.28;g_modal_window_width>
a[0]&&(g_modal_window_width=a[0],g_modal_window_height=g_modal_window_width*0.78125);g_modal_url="/smb/css/help.html?showbutton=1";$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_help"));b&&b.jqmShow()});$("#btnConfig").click(function(){var a=g_storage.get("misc_http_enable"),b=g_storage.get("misc_http_port"),c=window.location.host;a==0&&!isPrivateIP()?alert(m.getString("msg_no_config")):(a=isPrivateIP()?"http://"+c.split(":")[0]:"http://"+c.split(":")[0]+":"+b,window.location=
a)});$("#btnPlayImage").click(function(){openImageViewer()});$(window).resize(adjustLayout)});
